"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[6570],{6570:(Z,p,r)=>{r.r(p),r.d(p,{FormPageModule:()=>F});var y=r(7682),a=r(4728),l=r(5019),m=r(4696),u=r(6097),g=r(3142),h=r(1782),v=r(2863),b=r(2265),o=r(5506),f=r(1005);const O=[{path:"",component:(()=>{class s{constructor(t,e,n){this.activatedRoute=t,this.db=e,this.navCtrl=n,this.form=new a.cw({}),this.model={},this.options={}}ngOnInit(){var t=this;return(0,u.Z)(function*(){const e=yield t.activatedRoute.paramMap.pipe((0,g.P)()).toPromise();if(t.entityId=e?e.get("entity"):null,t.id=e?e.get("id"):null,t.entity=t.entityId?v.eG.entities[t.entityId]:null,t.entity?.form?.fields&&(t.fields=t.entity?.form?.fields.map(n=>{if(n.templateOptions?.dynamicOptions){const i=t.db.find(n.templateOptions?.dynamicOptions?.entityId).pipe((0,h.U)(d=>d.data.map(c=>({label:c[n.templateOptions?.dynamicOptions?.label],value:c[n.templateOptions?.dynamicOptions?.value],group:t.dotNotation(c,n.templateOptions?.dynamicOptions?.group)}))));n.templateOptions.options=i}return n})),t.id&&t.entityId){const n=yield t.db.get(t.entityId,t.id);n&&(t.model=t.getModelFields(n))}})()}getModelFields(t){const e=this.fields.map(i=>i.key?.toString().split(".")[0]);return Object.keys(t).reduce((i,d)=>((this.entity?.keyField===d||e.indexOf(d)>-1)&&(i[d]=this.dotNotation(t,d)),i),{})}ionViewDidLeave(){this.form.reset()}onSubmit(){var t=this;return(0,u.Z)(function*(){if(console.log("submit",t.model),"photos"===t.entityId)return t.uploadPhoto();try{yield t.db.save(t.entityId,t.model),t.navCtrl.navigateBack(`/admin/${t.entityId}/list`)}catch(e){console.error(e)}})()}uploadPhoto(){var t=this;return(0,u.Z)(function*(){console.log("submit",t.model);try{const e=t.model.file.needsUpload?yield t.getBlob(t.model.file.photoUrl):null;yield t.db.upload(e,t.model.file.format,t.model),t.navCtrl.navigateBack(`/admin/${t.entityId}/list`)}catch(e){console.error(e)}})()}getBlob(t){return new Promise((e,n)=>{const i=new XMLHttpRequest;i.onload=function(){e(i.response)},i.onerror=function(){n(new Error("getBlob failed"))},i.responseType="blob",i.open("GET",t,!0),i.send(null)})}dotNotation(t,e){return e?e.split(".").reduce((n,i)=>n[i],t):""}static#t=this.\u0275fac=function(e){return new(e||s)(o.Y36(m.gz),o.Y36(b.H),o.Y36(l.SH))};static#o=this.\u0275cmp=o.Xpm({type:s,selectors:[["seyconel-form"]],decls:15,vars:6,consts:[["slot","start"],[3,"text"],["slot","end"],[3,"click"],[3,"formGroup","ngSubmit"],[3,"form","fields","model","options"],["type","submit",1,"ion-margin-vertical"]],template:function(e,n){1&e&&(o.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),o._UZ(3,"ion-back-button",1)(4,"ion-menu-button"),o.qZA(),o.TgZ(5,"ion-title"),o._uU(6),o.qZA(),o.TgZ(7,"ion-buttons",2)(8,"ion-button",3),o.NdJ("click",function(){return n.onSubmit()}),o._uU(9," Salvar "),o.qZA()()()(),o.TgZ(10,"ion-content")(11,"form",4),o.NdJ("ngSubmit",function(){return n.onSubmit()}),o._UZ(12,"formly-form",5),o.TgZ(13,"ion-button",6),o._uU(14,"Salvar"),o.qZA()()()),2&e&&(o.xp6(6),o.Oqu(null==n.entity?null:n.entity.label),o.xp6(5),o.Q6J("formGroup",n.form),o.xp6(1),o.Q6J("form",n.form)("fields",n.fields)("model",n.model)("options",n.options))},dependencies:[a._Y,a.JL,l.oU,l.YG,l.Sm,l.W2,l.Gu,l.fG,l.wd,l.sr,l.cs,a.sg,f.T7],styles:["[_nghost-%COMP%]   form[_ngcontent-%COMP%]{max-width:800px;display:block;margin:20px auto}"]})}return s})()}];let P=(()=>{class s{static#t=this.\u0275fac=function(e){return new(e||s)};static#o=this.\u0275mod=o.oAB({type:s});static#n=this.\u0275inj=o.cJS({imports:[m.Bz.forChild(O),m.Bz]})}return s})(),F=(()=>{class s{static#t=this.\u0275fac=function(e){return new(e||s)};static#o=this.\u0275mod=o.oAB({type:s});static#n=this.\u0275inj=o.cJS({imports:[y.ez,a.u5,l.Pc,a.UX,f.X0,P]})}return s})()}}]);