"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[6632],{6632:(D,b,u)=>{u.r(b),u.d(b,{ListPageModule:()=>B});var m=u(7682),g=u(4728),s=u(5019),y=u(4696),d=u(6097),O=u(9999),v=u(3142),C=u(1378),q=u(5741),_=u(1782),P=u(2863),Z=u(2265),t=u(5506),M=u(1005);let T=(()=>{class r{constructor(e,n,o){this.activatedRoute=e,this.db=n,this.modalCtrl=o,this.form=new g.cw({}),this.model={},this.options={}}ngOnInit(){var e=this;return(0,d.Z)(function*(){e.entity=e.entityId?P.eG.entities[e.entityId]:null,e.entity?.filters?.fields&&(e.fields=e.entity?.filters?.fields.map(n=>{if(n.templateOptions?.dynamicOptions){const o=e.db.find(n.templateOptions?.dynamicOptions?.entityId).pipe((0,_.U)(i=>i.data.map(c=>({label:c[n.templateOptions?.dynamicOptions?.label],value:c[n.templateOptions?.dynamicOptions?.value],group:e.dotNotation(c,n.templateOptions?.dynamicOptions?.group)}))));n.templateOptions.options=o}return n})),console.log("this.id",e.id),e.id&&e.entityId&&console.log(e.model)})()}ionViewDidLeave(){this.form.reset()}onSubmit(){var e=this;return(0,d.Z)(function*(){console.log("submit",e.model);try{e.modalCtrl.dismiss({...e.model})}catch(n){console.error(n)}})()}dotNotation(e,n){return n?n.split(".").reduce((o,i)=>o[i],e):""}static#t=this.\u0275fac=function(n){return new(n||r)(t.Y36(y.gz),t.Y36(Z.H),t.Y36(s.IN))};static#e=this.\u0275cmp=t.Xpm({type:r,selectors:[["seyconel-form"]],inputs:{entityId:"entityId"},decls:16,vars:11,consts:[["slot","start"],[3,"text"],["id","filter-form",3,"formGroup","ngSubmit"],[3,"form","fields","model","options"],["expand","full","type","submit","form","filter-form",1,"ion-margin-vertical",3,"click"]],template:function(n,o){1&n&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1)(4,"ion-menu-button"),t.qZA(),t.TgZ(5,"ion-title"),t._uU(6),t.ALo(7,"lowercase"),t.qZA()()(),t.TgZ(8,"ion-content")(9,"form",2),t.NdJ("ngSubmit",function(){return o.onSubmit()}),t._UZ(10,"formly-form",3),t.qZA(),t._uU(11),t.ALo(12,"json"),t.qZA(),t.TgZ(13,"ion-footer")(14,"ion-button",4),t.NdJ("click",function(){return o.onSubmit()}),t._uU(15,"Filtrar"),t.qZA()()),2&n&&(t.xp6(6),t.hij("Filtrar ",t.lcZ(7,7,null==o.entity?null:o.entity.label),""),t.xp6(3),t.Q6J("formGroup",o.form),t.xp6(1),t.Q6J("form",o.form)("fields",o.fields)("model",o.model)("options",o.options),t.xp6(1),t.hij(" ",t.lcZ(12,9,o.model),"\n"))},dependencies:[g._Y,g.JL,s.oU,s.YG,s.Sm,s.W2,s.fr,s.Gu,s.fG,s.wd,s.sr,s.cs,M.T7,g.sg,m.i8,m.Ts],styles:["[_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]{margin:0;padding:0}[_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-inline-end:16px}[_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin:0;min-height:56px}"]})}return r})();var x=u(201),w=u(8422),F=u(9741);const A=["datatable"],L=["buttonsTemplate"],k=["searchBar"];function E(r,p){if(1&r){const e=t.EpF();t.TgZ(0,"ion-button",12),t.NdJ("click",function(o){t.CHM(e);const i=t.oxw();return t.KtG(i.openPopover(o))}),t._UZ(1,"ion-icon",13),t.qZA()}}function I(r,p){if(1&r){const e=t.EpF();t.TgZ(0,"ion-button",14),t.NdJ("click",function(){const i=t.CHM(e).$implicit,l=t.oxw();return t.KtG(l.removeFilter(i.value))}),t._uU(1),t._UZ(2,"ion-icon",15),t.qZA()}if(2&r){const e=p.$implicit,n=t.oxw();t.xp6(1),t.AsE(" ",n.filtersLabel[null==e?null:e.value.field],": ",n.renderFilter(e.value)," ")}}function S(r,p){if(1&r){const e=t.EpF();t.TgZ(0,"ion-button",20),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().row,i=t.oxw();return t.KtG(i.detail(o))}),t._UZ(1,"ion-icon",21),t.qZA()}}function J(r,p){if(1&r){const e=t.EpF();t.TgZ(0,"ion-button",22),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().row,i=t.oxw();return t.KtG(i.report(o))}),t._UZ(1,"ion-icon",23),t.qZA()}if(2&r){const e=t.oxw().row;t.Q6J("disabled",null==e?null:e.completed)}}function N(r,p){if(1&r){const e=t.EpF();t.TgZ(0,"ion-button",20),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().row,i=t.oxw();return t.KtG(i.print(o))}),t._UZ(1,"ion-icon",24),t.qZA()}}function G(r,p){if(1&r){const e=t.EpF();t.TgZ(0,"ion-button",25),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().row,i=t.oxw();return t.KtG(i.edit(o))}),t._UZ(1,"ion-icon",26),t.qZA()}}function U(r,p){if(1&r){const e=t.EpF();t.TgZ(0,"ion-button",27),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().row,i=t.oxw();return t.KtG(i.remove(o))}),t._UZ(1,"ion-icon",28),t.qZA()}}function H(r,p){if(1&r&&(t.TgZ(0,"ion-buttons"),t.YNc(1,S,2,0,"ion-button",16),t.YNc(2,J,2,1,"ion-button",17),t.YNc(3,N,2,0,"ion-button",16),t.YNc(4,G,2,0,"ion-button",18),t.YNc(5,U,2,0,"ion-button",19),t.qZA()),2&r){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.actions.detail),t.xp6(1),t.Q6J("ngIf",e.actions.report),t.xp6(1),t.Q6J("ngIf",e.actions.print),t.xp6(1),t.Q6J("ngIf",e.actions.edit),t.xp6(1),t.Q6J("ngIf",e.actions.remove)}}const Y=function(r){return{hasFilter:r}},$=function(){return{prop:"modifiedAt",dir:"desc"}},z=function(r){return[r]},j=function(){return{emptyMessage:"Nenhum registro encontrado."}},Q=[{path:"",component:(()=>{class r{constructor(e,n,o,i,l,c,a){this.activatedRoute=e,this.db=n,this.popoverList=o,this.navCtrl=i,this.alertCtrl=l,this.toastCtrl=c,this.modalCtrl=a,this.loading=!0,this.dataSubject=new O.x,this.searchEnabled=!1,this.actions={},this.totalElements=0,this.query={page:1,offset:0,limit:15,sort:{field:"modifiedAt",order:"DESC"}},this.filtersLabel={},this.filtersValueLabel={}}ngOnInit(){var e=this;return(0,d.Z)(function*(){const n=yield e.activatedRoute.paramMap.pipe((0,v.P)()).toPromise(),o=yield e.activatedRoute.queryParamMap.pipe((0,v.P)()).toPromise(),i=n?n.get("entity"):null;if(!i)return;if(e.entityId=i,e.entity=P.eG.entities[e.entityId],e.entity.list?.queryFilters){e.query.filter||(e.query.filter=[]),Array.isArray(e.query.filter)||(e.query.filter=[e.query.filter]);for(const a of e.entity.list?.queryFilters){const f=o?o.get(a):null;f&&e.query.filter.push({field:a,operator:"eq",value:f})}}const l={};e.actions=e.entity.actions?e.entity.actions?.reduce((a,f)=>(a[f]=!0,a),l):l,e.cols=[...e.entity?.list?.columns?[...e.entity.list.columns]:[],{prop:"id",width:e.calcActionsColWidth(e.entity),maxWidth:e.calcActionsColWidth(e.entity),minWidth:e.calcActionsColWidth(e.entity),cellClass:"action-buttons",name:"A\xe7\xf5es",sortable:!1,cellTemplate:e.buttonsTemplate}];const c={};e.filtersLabel=e.entity.filters?.fields?e.entity.filters?.fields?.reduce((a,f)=>{const h=f.key;return h&&f.templateOptions?.label&&(a[h]=f.templateOptions.label),a},c):c,e.data$=e.dataSubject.pipe((0,C.b)(()=>{e.loading=!0}),(0,q.w)(a=>(console.log({res:a}),e.db.find(e.entityId,a))),(0,_.U)(a=>(console.log("res",a),e.getFiltersValueLabel(a.data),e.query.page=a.page-1,e.totalElements=a.total,a)),(0,C.b)(()=>{e.loading=!1}),(0,_.U)(a=>a.data))})()}rowIdentity(e){return e.id}renderFilter(e){return e.field.endsWith("Id")&&this.filtersValueLabel[e.value]?this.filtersValueLabel[e.value]:e.value}ngOnDestroy(){}ionViewDidEnter(){console.log("onEnter"),this.refreshData(),this.datatable.recalculate()}refreshData(){this.dataSubject.next(this.query)}getFiltersValueLabel(e){if(this.entity?.list?.queryFilters&&e&&!(e.length<1))for(const n of this.entity?.list?.queryFilters){const o=n.slice(0,-2);console.log({relatedField:o});const i=e[0][o];console.log({related:i}),this.filtersValueLabel[i.id]=i.name}}setPage(e){this.loading=!0,console.log("setpage",e),void 0!==e.offset&&(this.query.page=e.offset+1),void 0!==e.count&&e.count>0&&this.dataSubject.next(this.query)}setSort(e){console.log("Sort Event",e),this.loading=!0;const n=e?.sorts[0],o=n.dir.toLocaleUpperCase();this.query.sort={field:n.prop,order:o},this.dataSubject.next(this.query)}setSearch(e){var n=this;return(0,d.Z)(function*(){if(!n.entity||!n.entity.search)return;const{detail:o}=e,{value:i}=o;n.loading=!0,n.query.offset=0,n.query.search=""!==i?n.entity.search(i):{},n.dataSubject.next(n.query)})()}removeFilter(e){var n=this;return(0,d.Z)(function*(){console.log("removeFilter",e),Array.isArray(n.query.filter)&&(console.log("is Array",n.query.filter),n.query.filter=n.query.filter.filter(o=>o.field!==e.field)),n.dataSubject.next(n.query)})()}openPopover(e){var n=this;return(0,d.Z)(function*(){if(!n.entity||!n.entity.actions)return;const o=[...n.entity.actions?.indexOf("add")>-1?[{label:"Adicionar",icon:"add",handler:()=>n.navCtrl.navigateForward(`/admin/${n.entityId}/form`)}]:[],...n.entity.actions?.indexOf("search")>-1?[{label:"Pesquisar",icon:"search",handler:()=>{n.searchEnabled=!0,n.query.filter&&(delete n.query.filter,n.dataSubject.next(n.query)),setTimeout(()=>{n.searchBar.setFocus()},250)}}]:[],...n.entity.actions?.indexOf("filter")>-1?[{label:"Filtrar",icon:"funnel",handler:()=>{n.openFilter()}}]:[]];yield n.popoverList.open(e,o)})()}openFilter(){var e=this;return(0,d.Z)(function*(){const n=yield e.modalCtrl.create({component:T,componentProps:{entityId:e.entityId}});yield n.present();const{data:o}=yield n.onDidDismiss();if(o){const i=[];delete e.query.search,e.query.filter=Object.keys(o).filter(l=>!!o[l]).reduce((l,c)=>(l.push({field:c,operator:"$eq",value:o[c]}),l),i),e.searchEnabled=!1,e.dataSubject.next(e.query)}})()}detail(e){var n=this;return(0,d.Z)(function*(){if(console.log("detail",e),!n.entity)throw new Error("Entity not defined");n.navCtrl.navigateForward(`/admin/${n.entityId}/detail/${e[n.entity.keyField]}`)})()}export(e){var n=this;return(0,d.Z)(function*(){if(console.log("report",e),!n.entity)throw new Error("Entity not defined");window.open(`${x.N.apiUrl}/pdf/${e[n.entity.keyField]}`)})()}edit(e){var n=this;return(0,d.Z)(function*(){if(console.log("edit",e),!n.entity)throw new Error("Entity not defined");n.navCtrl.navigateForward(`/admin/${n.entityId}/form/${e[n.entity.keyField]}`)})()}print(e){var n=this;return(0,d.Z)(function*(){if(console.log("report",e),!n.entity)throw new Error("Entity not defined");window.open(`${x.N.apiUrl}/reports/pdf/${e[n.entity.keyField]}`)})()}remove(e){var n=this;return(0,d.Z)(function*(){if(console.log("remove",e),!n.entity)throw new Error("Entity not defined");var i;yield(yield n.alertCtrl.create({header:`Remover ${n.entity?.labelSingular.toLocaleLowerCase()}`,message:`Voc\xea tem certeza que gostaria de remover "${e[n.entity.displayField]}"?`,buttons:[{text:"Cancelar",role:"cancel"},{text:"Remover",role:"destroy",handler:(i=(0,d.Z)(function*(){try{const c=e[n.entity.keyField];yield n.db.remove(n.entityId,c);const a=yield n.toastCtrl.create({header:"Removido!",message:`${n.entity.labelSingular} removido com sucesso.`,color:"success",duration:3e3,position:"top",buttons:[{icon:"close"}]});n.refreshData(),yield a.present()}catch{yield(yield n.toastCtrl.create({header:"Erro!",message:"N\xe3o foi poss\xedvel remover o registro. Tente novamente.",color:"danger"})).present()}}),function(){return i.apply(this,arguments)})}]})).present()})()}report(e){var n=this;return(0,d.Z)(function*(){if(console.log("remove",e),!n.entity)throw new Error("Entity not defined");var i;yield(yield n.alertCtrl.create({header:"Relat\xf3rio",message:"Para gerar o relat\xf3rio preenchar o n\xfamero RI",inputs:[{name:"ri",type:"number"}],buttons:[{text:"Cancelar",role:"cancel"},{text:"Gerar relat\xf3rio",role:"destroy",handler:(i=(0,d.Z)(function*(l){try{yield n.db.customGet(`reports/generate/${e.id}/${l.ri}`);const f=yield n.toastCtrl.create({header:"Relat\xf3rio gerado!",message:`O relat\xf3rio de '${e[n.entity.displayField]}' foi gerado com sucesso.`,color:"success",duration:3e3,position:"top",buttons:[{icon:"close"}]});n.refreshData(),yield f.present()}catch{yield(yield n.toastCtrl.create({header:"Erro!",message:"N\xe3o foi poss\xedvel remover o registro. Tente novamente.",color:"danger"})).present()}}),function(c){return i.apply(this,arguments)})}]})).present()})()}calcActionsColWidth(e){if(!e?.actions)return 0;const n=["edit","detail","remove","report","print"];return 56*e.actions.reduce((l,c)=>(n.indexOf(c)>-1&&l++,l),0)}hasMenuActions(e){if(!e?.actions)return!1;const n=["add","search"];return!!e.actions.find(o=>n.indexOf(o)>-1)}static#t=this.\u0275fac=function(n){return new(n||r)(t.Y36(y.gz),t.Y36(Z.H),t.Y36(w.y),t.Y36(s.SH),t.Y36(s.Br),t.Y36(s.yF),t.Y36(s.IN))};static#e=this.\u0275cmp=t.Xpm({type:r,selectors:[["seyconel-list"]],viewQuery:function(n,o){if(1&n&&(t.Gf(A,5),t.Gf(L,5),t.Gf(k,5)),2&n){let i;t.iGM(i=t.CRH())&&(o.datatable=i.first),t.iGM(i=t.CRH())&&(o.buttonsTemplate=i.first),t.iGM(i=t.CRH())&&(o.searchBar=i.first)}},decls:26,vars:44,consts:[["slot","start",3,"hidden"],[3,"text"],[3,"hidden"],["color","dark","autofocus","",3,"debounce","showCancelButton","hidden","placeholder","ionChange","ionCancel"],["searchBar",""],["slot","end"],[3,"click",4,"ngIf"],[1,"filter-toolbar",3,"hidden"],["fill","outline","color","dark","size","small",3,"click",4,"ngFor","ngForOf"],[1,"material","fullscreen","striped",3,"ngClass","headerHeight","footerHeight","rowHeight","rows","rowIdentity","trackByProp","scrollbarV","scrollbarH","columnMode","columns","sorts","messages","externalPaging","count","offset","limit","virtualization","externalSorting","loadingIndicator","page","sort"],["datatable",""],["buttonsTemplate",""],[3,"click"],["name","ellipsis-vertical"],["fill","outline","color","dark","size","small",3,"click"],["name","close"],["color","medium","fill","clear","size","small",3,"click",4,"ngIf"],["color","medium","fill","clear","size","small",3,"disabled","click",4,"ngIf"],["color","primary","fill","clear","size","small",3,"click",4,"ngIf"],["color","danger","fill","clear","size","small",3,"click",4,"ngIf"],["color","medium","fill","clear","size","small",3,"click"],["name","eye","slot","icon-only"],["color","medium","fill","clear","size","small",3,"disabled","click"],["name","clipboard-outline","slot","icon-only"],["name","print-outline","slot","icon-only"],["color","primary","fill","clear","size","small",3,"click"],["name","create","slot","icon-only"],["color","danger","fill","clear","size","small",3,"click"],["name","trash","slot","icon-only"]],template:function(n,o){if(1&n&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1)(4,"ion-menu-button"),t.qZA(),t.TgZ(5,"ion-title",2),t._uU(6),t.qZA(),t.TgZ(7,"ion-searchbar",3,4),t.NdJ("ionChange",function(l){return o.setSearch(l)})("ionCancel",function(){return o.searchEnabled=!1}),t.qZA(),t.TgZ(9,"ion-buttons",5),t.YNc(10,E,2,0,"ion-button",6),t.qZA()(),t.TgZ(11,"ion-toolbar",7),t.ALo(12,"keyvalue"),t.TgZ(13,"ion-buttons")(14,"span"),t._uU(15,"Filtrado por:"),t.qZA(),t.YNc(16,I,3,2,"ion-button",8),t.ALo(17,"keyvalue"),t.qZA()()(),t.TgZ(18,"ion-content")(19,"div")(20,"ngx-datatable",9,10),t.NdJ("page",function(l){return o.setPage(l)})("sort",function(l){return o.setSort(l)}),t.ALo(22,"keyvalue"),t.ALo(23,"async"),t.qZA(),t.YNc(24,H,6,5,"ng-template",null,11,t.W1O),t.qZA()()),2&n){let i,l;t.xp6(2),t.Q6J("hidden",o.searchEnabled),t.xp6(3),t.Q6J("hidden",o.searchEnabled),t.xp6(1),t.Oqu(null==o.entity?null:o.entity.label),t.xp6(1),t.Q6J("debounce",500)("showCancelButton",!0)("hidden",!o.searchEnabled)("placeholder","Pesquisar..."),t.xp6(3),t.Q6J("ngIf",o.hasMenuActions(o.entity)),t.xp6(1),t.Q6J("hidden",!(null!=(i=t.lcZ(12,30,null==o.query?null:o.query.filter))&&i.length)),t.xp6(5),t.Q6J("ngForOf",t.lcZ(17,32,null==o.query?null:o.query.filter)),t.xp6(4),t.Q6J("ngClass",t.VKq(38,Y,null==(l=t.lcZ(22,34,null==o.query?null:o.query.filter))?null:l.length))("headerHeight",50)("footerHeight",50)("rowHeight",50)("rows",t.lcZ(23,36,o.data$))("rowIdentity",o.rowIdentity)("trackByProp","id")("scrollbarV",!0)("scrollbarH",!0)("columnMode","force")("columns",o.cols)("sorts",t.VKq(41,z,t.DdM(40,$)))("messages",t.DdM(43,j))("externalPaging",!0)("count",o.totalElements)("offset",o.query.offset?o.query.offset:0)("limit",null!=o.query&&o.query.limit?o.query.limit:0)("virtualization",!1)("externalSorting",!0)("loadingIndicator",o.loading)}},dependencies:[m.mk,m.sg,m.O5,s.oU,s.YG,s.Sm,s.W2,s.Gu,s.gu,s.fG,s.VI,s.wd,s.sr,s.j9,s.cs,F.nE,m.Ov,m.Nd],styles:["[_nghost-%COMP%]   ion-searchbar[_ngcontent-%COMP%]{--background: transparent}[_nghost-%COMP%]   ngx-datatable[_ngcontent-%COMP%]{height:calc(100vh - var(--ia-list-top, 56px))}[_nghost-%COMP%]   ngx-datatable.hasFilter[_ngcontent-%COMP%]{--ia-list-top: 112px}[_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar.filter-toolbar[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:12px;margin-bottom:2px;padding-right:16px}[_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar.filter-toolbar[_ngcontent-%COMP%]   ion-buttons[_ngcontent-%COMP%]{padding-left:22px}[_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar.filter-toolbar[_ngcontent-%COMP%]   ion-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{text-transform:none}"]})}return r})()}];let R=(()=>{class r{static#t=this.\u0275fac=function(n){return new(n||r)};static#e=this.\u0275mod=t.oAB({type:r});static#n=this.\u0275inj=t.cJS({imports:[y.Bz.forChild(Q),y.Bz]})}return r})();var V=u(9063);let B=(()=>{class r{static#t=this.\u0275fac=function(n){return new(n||r)};static#e=this.\u0275mod=t.oAB({type:r});static#n=this.\u0275inj=t.cJS({imports:[m.ez,g.u5,s.Pc,F.xD,R,V.K]})}return r})()}}]);