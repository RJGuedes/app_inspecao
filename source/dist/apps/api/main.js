(()=>{"use strict";var e=[,e=>{e.exports=require("@nestjs/common")},e=>{e.exports=require("@nestjs/core")},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AppModule=void 0;const o=a(4),r=a(1),i=a(5),n=a(8),s=a(24),l=a(31),d=a(41),c=a(47),p=a(52),m=a(57),u=a(62),y=a(67),_=a(72),v=a(83),g=a(84);let f=t.AppModule=class AppModule{};t.AppModule=f=o.__decorate([(0,r.Module)({imports:[s.DatabaseModule,l.AuthModule,d.UserModule,c.CustomerModule,u.SurveyModule,y.SectorModule,p.ItemModule,m.LogModule,_.PhotoModule,v.EventsModule,g.ReportModule],controllers:[i.AppController],providers:[n.SyncService]})],f)},e=>{e.exports=require("tslib")},(e,t,a)=>{var o,r,i;Object.defineProperty(t,"__esModule",{value:!0}),t.AppController=void 0;const n=a(4),s=a(1),l=a(6),d=a(8),c=a(18),p=a(19);let m=t.AppController=class AppController{constructor(e,t){this.syncService=e,this.eventsGateway=t}index(){return{api:!0}}getSync(){return this.syncService.getSync()}ws(){return this.eventsGateway.server.emit("events",{message:"working"})}postSync(e,t){return this.syncService.postSync(e,t)}async xls(e){const t=[[1,2,3],[!0,!1,null,"sheetjs"],["foo","bar",new Date("2014-02-19T14:30Z"),"0.3"],["baz",null,"qux"]],a=c.default.build([{name:"Seyconel",data:t,options:{}}]);e.set({"Content-Type":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","Content-disposition":"attachment; filename=testingHere.xlsx"}),e.end(a)}};n.__decorate([(0,s.Get)(),n.__metadata("design:type",Function),n.__metadata("design:paramtypes",[]),n.__metadata("design:returntype",void 0)],m.prototype,"index",null),n.__decorate([(0,s.Get)("sync"),n.__metadata("design:type",Function),n.__metadata("design:paramtypes",[]),n.__metadata("design:returntype",void 0)],m.prototype,"getSync",null),n.__decorate([(0,s.Get)("ws"),n.__metadata("design:type",Function),n.__metadata("design:paramtypes",[]),n.__metadata("design:returntype",void 0)],m.prototype,"ws",null),n.__decorate([(0,s.UseGuards)(l.JwtAuthGuard),(0,s.Post)("sync/:entityId"),n.__param(0,(0,s.Param)("entityId")),n.__param(1,(0,s.Body)("data")),n.__metadata("design:type",Function),n.__metadata("design:paramtypes",[String,Object]),n.__metadata("design:returntype",void 0)],m.prototype,"postSync",null),n.__decorate([(0,s.Get)("/xls"),n.__param(0,(0,s.Response)()),n.__metadata("design:type",Function),n.__metadata("design:paramtypes",[Object]),n.__metadata("design:returntype","function"==typeof(i="undefined"!=typeof Promise&&Promise)?i:Object)],m.prototype,"xls",null),t.AppController=m=n.__decorate([(0,s.Controller)(),n.__metadata("design:paramtypes",["function"==typeof(o=void 0!==d.SyncService&&d.SyncService)?o:Object,"function"==typeof(r=void 0!==p.EventsGateway&&p.EventsGateway)?r:Object])],m)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.JwtAuthGuard=void 0;const o=a(4),r=a(1),i=a(7);let n=t.JwtAuthGuard=class JwtAuthGuard extends((0,i.AuthGuard)("jwt")){canActivate(e){return super.canActivate(e)}};t.JwtAuthGuard=n=o.__decorate([(0,r.Injectable)()],n)},e=>{e.exports=require("@nestjs/passport")},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.SyncService=void 0;const r=a(4),i=a(1),n=a(9),s=a(10),l=a(15),d=a(14),c=a(12);let p=t.SyncService=class SyncService{constructor(e){this.connection=e,this.entities={customers:s.CustomerEntity,surveys:c.SurveyEntity,sectors:d.SectorEntity,items:l.ItemEntity}}async getSync(){const e=this.connection.getRepository(c.SurveyEntity);try{return(await e.find({where:{completed:!1},relations:["customer"]})).reduce(((e,t)=>{const{customer:a,...o}=t;return e.surveys.push(o),e.customers.findIndex((e=>e.id===a.id))<0&&e.customers.push(a),e}),{customers:[],surveys:[]})}catch(t){console.error(t)}}async postSync(e,t){const a=this.connection.getRepository(this.entities[e]),o=[];for(const i of t)try{const e=await a.save(i),t=await a.findOne({where:{id:e.id}});console.log("sync",e),console.log("sync saved",t),console.log("modifiedAt",t.modifiedAt),o.push({sync:!0,syncedAt:t.modifiedAt?this.getFormattedDate(new Date(t.modifiedAt)):null,id:e.id})}catch(r){console.error(r),o.push({sync:!1,id:i.id})}return o}getFormattedDate(e){return e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)+" "+("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)+":"+("0"+e.getSeconds()).slice(-2)}};t.SyncService=p=r.__decorate([(0,i.Injectable)(),r.__param(0,(0,i.Inject)("DATABASE_CONNECTION")),r.__metadata("design:paramtypes",["function"==typeof(o=void 0!==n.Connection&&n.Connection)?o:Object])],p)},e=>{e.exports=require("typeorm")},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CustomerEntity=void 0;const o=a(4),r=a(9),i=a(11),n=a(12);let s=t.CustomerEntity=class CustomerEntity extends i.IaBaseEntity{};o.__decorate([(0,r.PrimaryGeneratedColumn)("uuid"),o.__metadata("design:type",String)],s.prototype,"id",void 0),o.__decorate([(0,r.Column)({length:255}),o.__metadata("design:type",String)],s.prototype,"name",void 0),o.__decorate([(0,r.Column)({length:255}),o.__metadata("design:type",String)],s.prototype,"cnpj",void 0),o.__decorate([(0,r.Column)({default:0}),o.__metadata("design:type",Number)],s.prototype,"surveysCount",void 0),o.__decorate([(0,r.OneToMany)((()=>n.SurveyEntity),(e=>e.customer)),(0,r.JoinColumn)(),o.__metadata("design:type",Array)],s.prototype,"surveys",void 0),t.CustomerEntity=s=o.__decorate([(0,r.Entity)("customers")],s)},(e,t,a)=>{var o,r;Object.defineProperty(t,"__esModule",{value:!0}),t.IaBaseEntity=void 0;const i=a(4),n=a(9);class IaBaseEntity{}t.IaBaseEntity=IaBaseEntity,i.__decorate([(0,n.PrimaryGeneratedColumn)("uuid"),i.__metadata("design:type",String)],IaBaseEntity.prototype,"id",void 0),i.__decorate([(0,n.CreateDateColumn)({type:"timestamp"}),i.__metadata("design:type","function"==typeof(o="undefined"!=typeof Date&&Date)?o:Object)],IaBaseEntity.prototype,"createdAt",void 0),i.__decorate([(0,n.UpdateDateColumn)({type:"timestamp"}),i.__metadata("design:type","function"==typeof(r="undefined"!=typeof Date&&Date)?r:Object)],IaBaseEntity.prototype,"modifiedAt",void 0)},(e,t,a)=>{var o,r;Object.defineProperty(t,"__esModule",{value:!0}),t.SurveyEntity=void 0;const i=a(4),n=a(9),s=a(11),l=a(10),d=a(13),c=a(14);let p=t.SurveyEntity=class SurveyEntity extends s.IaBaseEntity{};i.__decorate([(0,n.Column)({length:255}),i.__metadata("design:type",String)],p.prototype,"name",void 0),i.__decorate([(0,n.Column)({nullable:!0}),i.__metadata("design:type",Number)],p.prototype,"month",void 0),i.__decorate([(0,n.Column)({nullable:!0}),i.__metadata("design:type",Number)],p.prototype,"year",void 0),i.__decorate([(0,n.Column)({length:255,nullable:!0}),i.__metadata("design:type",String)],p.prototype,"city",void 0),i.__decorate([(0,n.Column)({length:255,nullable:!0}),i.__metadata("design:type",String)],p.prototype,"state",void 0),i.__decorate([(0,n.ManyToOne)((()=>l.CustomerEntity),(e=>e.surveys)),i.__metadata("design:type","function"==typeof(o=void 0!==l.CustomerEntity&&l.CustomerEntity)?o:Object)],p.prototype,"customer",void 0),i.__decorate([(0,n.Index)(),(0,n.Column)({nullable:!0}),i.__metadata("design:type",String)],p.prototype,"customerId",void 0),i.__decorate([(0,n.Column)({default:0}),i.__metadata("design:type",Number)],p.prototype,"sectorsCount",void 0),i.__decorate([(0,n.OneToMany)((()=>c.SectorEntity),(e=>e.survey)),i.__metadata("design:type",Array)],p.prototype,"sectors",void 0),i.__decorate([(0,n.OneToMany)((()=>d.ReportEntity),(e=>e.survey)),i.__metadata("design:type",Array)],p.prototype,"reports",void 0),i.__decorate([(0,n.Column)({type:"timestamp",nullable:!0}),i.__metadata("design:type","function"==typeof(r="undefined"!=typeof Date&&Date)?r:Object)],p.prototype,"savedAt",void 0),i.__decorate([(0,n.Column)({default:!1}),i.__metadata("design:type",Boolean)],p.prototype,"completed",void 0),t.SurveyEntity=p=i.__decorate([(0,n.Entity)("surveys")],p)},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.ReportEntity=void 0;const r=a(4),i=a(9),n=a(11),s=a(12);let l=t.ReportEntity=class ReportEntity extends n.IaBaseEntity{};r.__decorate([(0,i.Column)({length:255}),r.__metadata("design:type",String)],l.prototype,"name",void 0),r.__decorate([(0,i.Column)({type:"int",default:0}),r.__metadata("design:type",Number)],l.prototype,"ri",void 0),r.__decorate([(0,i.ManyToOne)((()=>s.SurveyEntity),(e=>e.reports)),r.__metadata("design:type","function"==typeof(o=void 0!==s.SurveyEntity&&s.SurveyEntity)?o:Object)],l.prototype,"survey",void 0),r.__decorate([(0,i.Index)(),(0,i.Column)({nullable:!0}),r.__metadata("design:type",String)],l.prototype,"surveyId",void 0),r.__decorate([(0,i.Column)({type:"json",nullable:!0,default:null}),r.__metadata("design:type",Object)],l.prototype,"data",void 0),t.ReportEntity=l=r.__decorate([(0,i.Entity)("reports")],l)},(e,t,a)=>{var o,r;Object.defineProperty(t,"__esModule",{value:!0}),t.SectorEntity=void 0;const i=a(4),n=a(9),s=a(11),l=a(15),d=a(12);let c=t.SectorEntity=class SectorEntity extends s.IaBaseEntity{};i.__decorate([(0,n.Column)({length:255}),i.__metadata("design:type",String)],c.prototype,"name",void 0),i.__decorate([(0,n.ManyToOne)((()=>d.SurveyEntity),(e=>e.sectors)),i.__metadata("design:type","function"==typeof(o=void 0!==d.SurveyEntity&&d.SurveyEntity)?o:Object)],c.prototype,"survey",void 0),i.__decorate([(0,n.Column)({nullable:!0}),i.__metadata("design:type",String)],c.prototype,"surveyId",void 0),i.__decorate([(0,n.Column)({default:0}),i.__metadata("design:type",Number)],c.prototype,"itemsCount",void 0),i.__decorate([(0,n.OneToMany)((()=>l.ItemEntity),(e=>e.sector)),i.__metadata("design:type",Array)],c.prototype,"items",void 0),i.__decorate([(0,n.Column)({type:"timestamp",nullable:!0}),i.__metadata("design:type","function"==typeof(r="undefined"!=typeof Date&&Date)?r:Object)],c.prototype,"savedAt",void 0),t.SectorEntity=c=i.__decorate([(0,n.Entity)("sectors")],c)},(e,t,a)=>{var o,r;Object.defineProperty(t,"__esModule",{value:!0}),t.ItemEntity=void 0;const i=a(4),n=a(9),s=a(11),l=a(16),d=a(14);let c=t.ItemEntity=class ItemEntity extends s.IaBaseEntity{};i.__decorate([(0,n.Column)({length:255}),i.__metadata("design:type",String)],c.prototype,"traceability",void 0),i.__decorate([(0,n.OneToMany)((()=>l.PhotoEntity),(e=>e.item)),i.__metadata("design:type","function"==typeof(o=void 0!==l.PhotoEntity&&l.PhotoEntity)?o:Object)],c.prototype,"photos",void 0),i.__decorate([(0,n.ManyToOne)((()=>d.SectorEntity),(e=>e.items)),i.__metadata("design:type","function"==typeof(r=void 0!==d.SectorEntity&&d.SectorEntity)?r:Object)],c.prototype,"sector",void 0),i.__decorate([(0,n.Column)({nullable:!0}),i.__metadata("design:type",String)],c.prototype,"sectorId",void 0),i.__decorate([(0,n.Column)({type:"json",nullable:!0,default:null}),i.__metadata("design:type",Object)],c.prototype,"data",void 0),i.__decorate([(0,n.Column)({nullable:!1,default:!1}),i.__metadata("design:type",Boolean)],c.prototype,"approved",void 0),t.ItemEntity=c=i.__decorate([(0,n.Entity)("items")],c)},(e,t,a)=>{var o,r;Object.defineProperty(t,"__esModule",{value:!0}),t.PhotoEntity=void 0;const i=a(4),n=a(17),s=a(9),l=a(11),d=a(15);let c=t.PhotoEntity=class PhotoEntity extends l.IaBaseEntity{getPhotoUrl(){this.photoUrl=this.file?`${n.environment.cdnUrl}/${this.file}`:null}};i.__decorate([(0,s.ManyToOne)((()=>d.ItemEntity),(e=>e.photos)),i.__metadata("design:type","function"==typeof(o=void 0!==d.ItemEntity&&d.ItemEntity)?o:Object)],c.prototype,"item",void 0),i.__decorate([(0,s.Column)({nullable:!0}),i.__metadata("design:type",String)],c.prototype,"itemId",void 0),i.__decorate([(0,s.Column)({length:255}),i.__metadata("design:type",String)],c.prototype,"file",void 0),i.__decorate([(0,s.Column)({type:"simple-json",nullable:!0}),i.__metadata("design:type",String)],c.prototype,"data",void 0),i.__decorate([(0,s.Column)({type:"timestamp",nullable:!0}),i.__metadata("design:type","function"==typeof(r="undefined"!=typeof Date&&Date)?r:Object)],c.prototype,"savedAt",void 0),i.__decorate([(0,s.AfterLoad)(),i.__metadata("design:type",Function),i.__metadata("design:paramtypes",[]),i.__metadata("design:returntype",void 0)],c.prototype,"getPhotoUrl",null),t.PhotoEntity=c=i.__decorate([(0,s.Entity)("photos")],c)},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.environment=void 0,t.environment={production:!0,db:{host:"localhost",port:3306,username:"inspecao",password:"IZc3?nG994@=",database:"inspecao"},cdnUrl:"https://apiinspecao.seyconel.com.br/files"}},e=>{e.exports=require("node-xlsx")},(e,t,a)=>{var o,r;Object.defineProperty(t,"__esModule",{value:!0}),t.EventsGateway=void 0;const i=a(4),n=a(20),s=a(21),l=a(22),d=a(23);let c=t.EventsGateway=class EventsGateway{findAll(e){return(0,s.from)([1,2,3]).pipe((0,l.map)((e=>({event:"events",data:e}))))}};i.__decorate([(0,n.WebSocketServer)(),i.__metadata("design:type","function"==typeof(o=void 0!==d.Server&&d.Server)?o:Object)],c.prototype,"server",void 0),i.__decorate([(0,n.SubscribeMessage)("events"),i.__param(0,(0,n.MessageBody)()),i.__metadata("design:type",Function),i.__metadata("design:paramtypes",[Object]),i.__metadata("design:returntype","function"==typeof(r=void 0!==s.Observable&&s.Observable)?r:Object)],c.prototype,"findAll",null),t.EventsGateway=c=i.__decorate([(0,n.WebSocketGateway)(3334,{cors:!0})],c)},e=>{e.exports=require("@nestjs/websockets")},e=>{e.exports=require("rxjs")},e=>{e.exports=require("rxjs/operators")},e=>{e.exports=require("socket.io")},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseModule=void 0;const o=a(4),r=a(1),i=a(25);let n=t.DatabaseModule=class DatabaseModule{};t.DatabaseModule=n=o.__decorate([(0,r.Module)({providers:[...i.databaseProviders],exports:[...i.databaseProviders]})],n)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.databaseProviders=void 0;const o=a(9),r=a(26),i=a(10),n=a(27),s=a(15),l=a(28),d=a(12),c=a(29),p=a(30),m=a(14),u=a(17),y=a(16),_=a(13);t.databaseProviders=[{provide:r.DATABASE_CONNECTION,useFactory:async()=>await(0,o.createConnection)({type:"mysql",...u.environment.db,entities:[n.UserEntity,i.CustomerEntity,d.SurveyEntity,m.SectorEntity,s.ItemEntity,y.PhotoEntity,l.LogEntity,_.ReportEntity],subscribers:[c.SurveySubscriber,p.ItemSubscriber],synchronize:!0})}]},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DATABASE_CONNECTION=void 0,t.DATABASE_CONNECTION="DATABASE_CONNECTION"},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UserEntity=void 0;const o=a(4),r=a(9),i=a(11),n=a(28);let s=t.UserEntity=class UserEntity extends i.IaBaseEntity{};o.__decorate([(0,r.Column)({length:255}),o.__metadata("design:type",String)],s.prototype,"name",void 0),o.__decorate([(0,r.Column)({length:255}),o.__metadata("design:type",String)],s.prototype,"email",void 0),o.__decorate([(0,r.Column)({length:255}),o.__metadata("design:type",String)],s.prototype,"password",void 0),o.__decorate([(0,r.OneToMany)((()=>n.LogEntity),(e=>e.user)),o.__metadata("design:type",Array)],s.prototype,"logs",void 0),t.UserEntity=s=o.__decorate([(0,r.Entity)("users")],s)},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.LogEntity=void 0;const r=a(4),i=a(9),n=a(11),s=a(27);let l=t.LogEntity=class LogEntity extends n.IaBaseEntity{};r.__decorate([(0,i.Column)({length:255}),r.__metadata("design:type",String)],l.prototype,"name",void 0),r.__decorate([(0,i.Column)({type:"text"}),r.__metadata("design:type",String)],l.prototype,"description",void 0),r.__decorate([(0,i.ManyToOne)((()=>s.UserEntity),(e=>e.logs)),r.__metadata("design:type","function"==typeof(o=void 0!==s.UserEntity&&s.UserEntity)?o:Object)],l.prototype,"user",void 0),t.LogEntity=l=r.__decorate([(0,i.Entity)("logs")],l)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SurveySubscriber=void 0;const o=a(4),r=a(9),i=a(10),n=a(12);let s=t.SurveySubscriber=class SurveySubscriber{listenTo(){return n.SurveyEntity}async afterInsert(e){console.log("afterInsert",e.entity),await this.updateSurveyCount(e)}async afterUpdate(e){console.log("afterUpdate",e.updatedColumns),console.log("afterUpdate",e.entity),await this.updateSurveyCount(e)}async afterRemove(e){console.log("afterRemove",e.entity),await this.updateSurveyCount(e)}async updateSurveyCount(e){if(e.entity&&e.entity.customerId){const{customerId:t}=e.entity,a=e.manager,o=a.createQueryBuilder(n.SurveyEntity,"survey").where({customerId:t}),r=await o.getCount(),s=a.createQueryBuilder().update(i.CustomerEntity,{surveysCount:r}).where("id = :id",{id:t});await s.execute()}}};t.SurveySubscriber=s=o.__decorate([(0,r.EventSubscriber)()],s)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ItemSubscriber=void 0;const o=a(4),r=a(9),i=a(14),n=a(15);let s=t.ItemSubscriber=class ItemSubscriber{listenTo(){return n.ItemEntity}async afterInsert(e){console.log("afterInsert",r.EventSubscriber),await this.updateItemCount(e)}async afterUpdate(e){console.log("afterUpdate",e),await this.updateItemCount(e)}async afterRemove(e){console.log("afterRemove",e),await this.updateItemCount(e)}async updateItemCount(e){if(e.entity&&e.entity.sectorId){const{sectorId:t}=e.entity,a=e.manager,o=a.createQueryBuilder(n.ItemEntity,"item").where({sectorId:t}),r=await o.getCount(),s=a.createQueryBuilder().update(i.SectorEntity,{itemsCount:r}).where("id = :id",{id:t});await s.execute()}}};t.ItemSubscriber=s=o.__decorate([(0,r.EventSubscriber)()],s)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AuthModule=void 0;const o=a(4),r=a(1),i=a(32),n=a(36),s=a(38),l=a(41),d=a(7),c=a(33),p=a(40),m=a(46);let u=t.AuthModule=class AuthModule{};t.AuthModule=u=o.__decorate([(0,r.Module)({imports:[l.UserModule,d.PassportModule,c.JwtModule.register({secret:p.jwtConstants.secret,signOptions:{expiresIn:"3000d"}})],providers:[i.AuthService,n.LocalStrategy,s.JwtStrategy],exports:[i.AuthService],controllers:[m.AuthController]})],u)},(e,t,a)=>{var o,r;Object.defineProperty(t,"__esModule",{value:!0}),t.AuthService=void 0;const i=a(4),n=a(1),s=a(33),l=a(34);let d=t.AuthService=class AuthService{constructor(e,t){this.userService=e,this.jwtService=t}async checkLogin(e,t){const a=await this.userService.findByEmail(e);if(console.log({user:a}),a&&a.password===t){const{password:e,...t}=a;return this.generateToken(t)}throw new Error("Wrong credentials")}async generateToken(e){const t={email:e.email,sub:e.id};return{token:this.jwtService.sign(t),id:e.id,email:e.email,name:e.name}}};t.AuthService=d=i.__decorate([(0,n.Injectable)(),i.__metadata("design:paramtypes",["function"==typeof(o=void 0!==l.UserService&&l.UserService)?o:Object,"function"==typeof(r=void 0!==s.JwtService&&s.JwtService)?r:Object])],d)},e=>{e.exports=require("@nestjs/jwt")},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.UserService=void 0;const r=a(4),i=a(1),n=a(9),s=a(35);let l=t.UserService=class UserService extends s.TypeOrmCrudService{constructor(e){super(e),this.userRepository=e}async findAll(){return this.userRepository.find()}async findByEmail(e){return this.userRepository.findOne({where:{email:e},select:["id","name","email","password"]})}};t.UserService=l=r.__decorate([(0,i.Injectable)(),r.__param(0,(0,i.Inject)("USER_REPOSITORY")),r.__metadata("design:paramtypes",["function"==typeof(o=void 0!==n.Repository&&n.Repository)?o:Object])],l)},e=>{e.exports=require("@dataui/crud-typeorm")},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStrategy=void 0;const r=a(4),i=a(37),n=a(7),s=a(1),l=a(32);let d=t.LocalStrategy=class LocalStrategy extends((0,n.PassportStrategy)(i.Strategy)){constructor(e){super(),this.authService=e}async validate(e,t){const a=await this.authService.checkLogin(e,t);if(!a)throw new s.UnauthorizedException;return a}};t.LocalStrategy=d=r.__decorate([(0,s.Injectable)(),r.__metadata("design:paramtypes",["function"==typeof(o=void 0!==l.AuthService&&l.AuthService)?o:Object])],d)},e=>{e.exports=require("passport-local")},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.JwtStrategy=void 0;const o=a(4),r=a(39),i=a(7),n=a(1),s=a(40);let l=t.JwtStrategy=class JwtStrategy extends((0,i.PassportStrategy)(r.Strategy)){constructor(){super({jwtFromRequest:r.ExtractJwt.fromAuthHeaderAsBearerToken(),ignoreExpiration:!1,secretOrKey:s.jwtConstants.secret})}async validate(e){return console.log("validate"),{id:e.sub,email:e.email}}};t.JwtStrategy=l=o.__decorate([(0,n.Injectable)(),o.__metadata("design:paramtypes",[])],l)},e=>{e.exports=require("passport-jwt")},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.jwtConstants=void 0,t.jwtConstants={secret:"secretKey"}},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UserModule=void 0;const o=a(4),r=a(1),i=a(24),n=a(42),s=a(44),l=a(34);let d=t.UserModule=class UserModule{};t.UserModule=d=o.__decorate([(0,r.Module)({imports:[i.DatabaseModule],providers:[...s.userProviders,l.UserService],exports:[l.UserService],controllers:[n.UserController]})],d)},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.UserController=void 0;const r=a(4),i=a(1),n=a(43),s=a(6),l=a(27),d=a(34);let c=t.UserController=class UserController{constructor(e){this.service=e}};t.UserController=c=r.__decorate([(0,n.Crud)({model:{type:l.UserEntity},params:{slug:{field:"id",type:"uuid",primary:!0}},query:{alwaysPaginate:!0}}),(0,i.UseGuards)(s.JwtAuthGuard),(0,i.Controller)("users"),r.__metadata("design:paramtypes",["function"==typeof(o=void 0!==d.UserService&&d.UserService)?o:Object])],c)},e=>{e.exports=require("@dataui/crud")},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.userProviders=void 0;const o=a(27),r=a(26),i=a(45);t.userProviders=[{provide:i.USER_REPOSITORY,useFactory:e=>e.getRepository(o.UserEntity),inject:[r.DATABASE_CONNECTION]}]},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.USER_REPOSITORY=void 0,t.USER_REPOSITORY="USER_REPOSITORY"},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.AuthController=void 0;const r=a(4),i=a(1),n=a(32);let s=t.AuthController=class AuthController{constructor(e){this.auth=e}async authenticate(e){console.log({data:e});const{email:t,password:a}=e;try{return await this.auth.checkLogin(t,a)}catch(o){throw console.error(o),new i.HttpException("Unauthorized",401)}}};r.__decorate([(0,i.Post)("authenticate"),r.__param(0,(0,i.Body)()),r.__metadata("design:type",Function),r.__metadata("design:paramtypes",[Object]),r.__metadata("design:returntype",Promise)],s.prototype,"authenticate",null),t.AuthController=s=r.__decorate([(0,i.Controller)("auth"),r.__metadata("design:paramtypes",["function"==typeof(o=void 0!==n.AuthService&&n.AuthService)?o:Object])],s)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CustomerModule=void 0;const o=a(4),r=a(1),i=a(24),n=a(48),s=a(50),l=a(49);let d=t.CustomerModule=class CustomerModule{};t.CustomerModule=d=o.__decorate([(0,r.Module)({imports:[i.DatabaseModule],providers:[...s.customerProviders,l.CustomerService],exports:[l.CustomerService],controllers:[n.CustomerController]})],d)},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.CustomerController=void 0;const r=a(4),i=a(1),n=a(43),s=a(6),l=a(10),d=a(49);let c=t.CustomerController=class CustomerController{constructor(e){this.service=e}};t.CustomerController=c=r.__decorate([(0,n.Crud)({model:{type:l.CustomerEntity},params:{slug:{field:"id",type:"uuid",primary:!0}},query:{alwaysPaginate:!0}}),(0,i.UseGuards)(s.JwtAuthGuard),(0,i.Controller)("customers"),r.__metadata("design:paramtypes",["function"==typeof(o=void 0!==d.CustomerService&&d.CustomerService)?o:Object])],c)},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.CustomerService=void 0;const r=a(4),i=a(1),n=a(9),s=a(35);let l=t.CustomerService=class CustomerService extends s.TypeOrmCrudService{constructor(e){super(e),this.customerRepository=e}async findAll(){return this.customerRepository.find()}};t.CustomerService=l=r.__decorate([(0,i.Injectable)(),r.__param(0,(0,i.Inject)("CUSTOMER_REPOSITORY")),r.__metadata("design:paramtypes",["function"==typeof(o=void 0!==n.Repository&&n.Repository)?o:Object])],l)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.customerProviders=void 0;const o=a(10),r=a(26),i=a(51);t.customerProviders=[{provide:i.CUSTOMER_REPOSITORY,useFactory:e=>e.getRepository(o.CustomerEntity),inject:[r.DATABASE_CONNECTION]}]},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CUSTOMER_REPOSITORY=void 0,t.CUSTOMER_REPOSITORY="CUSTOMER_REPOSITORY"},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ItemModule=void 0;const o=a(4),r=a(1),i=a(24),n=a(53),s=a(55),l=a(54);let d=t.ItemModule=class ItemModule{};t.ItemModule=d=o.__decorate([(0,r.Module)({imports:[i.DatabaseModule],providers:[...s.itemProviders,l.ItemService],exports:[l.ItemService],controllers:[n.ItemController]})],d)},(e,t,a)=>{var o,r,i;Object.defineProperty(t,"__esModule",{value:!0}),t.ItemController=void 0;const n=a(4),s=a(1),l=a(43),d=a(6),c=a(15),p=a(54);let m=t.ItemController=class ItemController{constructor(e){this.service=e}get base(){return this}getMany(e){return this.service.getManyAndCount(e)}getOne(e){return this.service.getOneAndCount(e)}};n.__decorate([(0,l.Override)(),n.__param(0,(0,l.ParsedRequest)()),n.__metadata("design:type",Function),n.__metadata("design:paramtypes",["function"==typeof(r=void 0!==l.CrudRequest&&l.CrudRequest)?r:Object]),n.__metadata("design:returntype",void 0)],m.prototype,"getMany",null),n.__decorate([(0,l.Override)(),n.__param(0,(0,l.ParsedRequest)()),n.__metadata("design:type",Function),n.__metadata("design:paramtypes",["function"==typeof(i=void 0!==l.CrudRequest&&l.CrudRequest)?i:Object]),n.__metadata("design:returntype",void 0)],m.prototype,"getOne",null),t.ItemController=m=n.__decorate([(0,l.Crud)({model:{type:c.ItemEntity},params:{slug:{field:"id",type:"uuid",primary:!0}},query:{join:{sector:{eager:!0,allow:["name"],alias:"sector"},"sector.survey":{eager:!0,allow:["name"],alias:"sectorSurvey"},"sector.survey.customer":{eager:!0,allow:["name"],alias:"sectorSurveyCustomer"}},alwaysPaginate:!0}}),(0,s.UseGuards)(d.JwtAuthGuard),(0,s.Controller)("items"),n.__metadata("design:paramtypes",["function"==typeof(o=void 0!==p.ItemService&&p.ItemService)?o:Object])],m)},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.ItemService=void 0;const r=a(4),i=a(1),n=a(9),s=a(35);let l=t.ItemService=class ItemService extends s.TypeOrmCrudService{constructor(e){super(e),this.itemRepository=e}async getManyAndCount(e){const{parsed:t,options:a}=e,o=await this.createBuilder(t,a);return o.loadRelationCountAndMap("ItemEntity.photosCount","ItemEntity.photos","photosCount"),this.doGetMany(o,t,a)}async getOneAndCount(e){return this.getOneAndCountOrFail(e)}async getOneAndCountOrFail(e,t=!1,a=!1){const{parsed:o,options:r}=e,i=t?this.repo.createQueryBuilder(this.alias):await this.createBuilder(o,r,!0,a);t&&this.setSearchCondition(i,o.search,{}),i.loadRelationCountAndMap("ItemEntity.photosCount","ItemEntity.photos","photosCount");const n=a?await i.withDeleted().getOne():await i.getOne();return n||this.throwNotFoundException(this.alias),n}};t.ItemService=l=r.__decorate([(0,i.Injectable)(),r.__param(0,(0,i.Inject)("ITEM_REPOSITORY")),r.__metadata("design:paramtypes",["function"==typeof(o=void 0!==n.Repository&&n.Repository)?o:Object])],l)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.itemProviders=void 0;const o=a(15),r=a(26),i=a(56);t.itemProviders=[{provide:i.ITEM_REPOSITORY,useFactory:e=>e.getRepository(o.ItemEntity),inject:[r.DATABASE_CONNECTION]}]},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ITEM_REPOSITORY=void 0,t.ITEM_REPOSITORY="ITEM_REPOSITORY"},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LogModule=void 0;const o=a(4),r=a(1),i=a(24),n=a(58),s=a(60),l=a(59);let d=t.LogModule=class LogModule{};t.LogModule=d=o.__decorate([(0,r.Module)({imports:[i.DatabaseModule],providers:[...s.logProviders,l.LogService],exports:[l.LogService],controllers:[n.LogController]})],d)},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.LogController=void 0;const r=a(4),i=a(1),n=a(43),s=a(6),l=a(28),d=a(59);let c=t.LogController=class LogController{constructor(e){this.service=e}};t.LogController=c=r.__decorate([(0,n.Crud)({model:{type:l.LogEntity},params:{slug:{field:"id",type:"uuid",primary:!0}},query:{alwaysPaginate:!0}}),(0,i.UseGuards)(s.JwtAuthGuard),(0,i.Controller)("logs"),r.__metadata("design:paramtypes",["function"==typeof(o=void 0!==d.LogService&&d.LogService)?o:Object])],c)},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.LogService=void 0;const r=a(4),i=a(1),n=a(9),s=a(35);let l=t.LogService=class LogService extends s.TypeOrmCrudService{constructor(e){super(e),this.logRepository=e}async findAll(){return this.logRepository.find()}};t.LogService=l=r.__decorate([(0,i.Injectable)(),r.__param(0,(0,i.Inject)("LOG_REPOSITORY")),r.__metadata("design:paramtypes",["function"==typeof(o=void 0!==n.Repository&&n.Repository)?o:Object])],l)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.logProviders=void 0;const o=a(28),r=a(26),i=a(61);t.logProviders=[{provide:i.LOG_REPOSITORY,useFactory:e=>e.getRepository(o.LogEntity),inject:[r.DATABASE_CONNECTION]}]},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LOG_REPOSITORY=void 0,t.LOG_REPOSITORY="LOG_REPOSITORY"},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SurveyModule=void 0;const o=a(4),r=a(1),i=a(24),n=a(63),s=a(65),l=a(64);let d=t.SurveyModule=class SurveyModule{};t.SurveyModule=d=o.__decorate([(0,r.Module)({imports:[i.DatabaseModule],providers:[...s.surveyProviders,l.SurveyService],exports:[...s.surveyProviders,l.SurveyService],controllers:[n.SurveyController]})],d)},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.SurveyController=void 0;const r=a(4),i=a(1),n=a(43),s=a(6),l=a(12),d=a(64);let c=t.SurveyController=class SurveyController{constructor(e){this.service=e}};t.SurveyController=c=r.__decorate([(0,n.Crud)({model:{type:l.SurveyEntity},params:{slug:{field:"id",type:"uuid",primary:!0}},query:{join:{customer:{eager:!0,allow:["name"],alias:"customer"}},alwaysPaginate:!0}}),(0,i.UseGuards)(s.JwtAuthGuard),(0,i.Controller)("surveys"),r.__metadata("design:paramtypes",["function"==typeof(o=void 0!==d.SurveyService&&d.SurveyService)?o:Object])],c)},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.SurveyService=void 0;const r=a(4),i=a(1),n=a(9),s=a(35);let l=t.SurveyService=class SurveyService extends s.TypeOrmCrudService{constructor(e){super(e),this.surveyRepository=e}async findAll(){return this.surveyRepository.find()}};t.SurveyService=l=r.__decorate([(0,i.Injectable)(),r.__param(0,(0,i.Inject)("SURVEY_REPOSITORY")),r.__metadata("design:paramtypes",["function"==typeof(o=void 0!==n.Repository&&n.Repository)?o:Object])],l)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.surveyProviders=void 0;const o=a(12),r=a(26),i=a(66);t.surveyProviders=[{provide:i.SURVEY_REPOSITORY,useFactory:e=>e.getRepository(o.SurveyEntity),inject:[r.DATABASE_CONNECTION]}]},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SURVEY_REPOSITORY=void 0,t.SURVEY_REPOSITORY="SURVEY_REPOSITORY"},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SectorModule=void 0;const o=a(4),r=a(1),i=a(24),n=a(68),s=a(70),l=a(69);let d=t.SectorModule=class SectorModule{};t.SectorModule=d=o.__decorate([(0,r.Module)({imports:[i.DatabaseModule],providers:[...s.sectorProviders,l.SectorService],exports:[l.SectorService],controllers:[n.SectorController]})],d)},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.SectorController=void 0;const r=a(4),i=a(1),n=a(43),s=a(6),l=a(14),d=a(69);let c=t.SectorController=class SectorController{constructor(e){this.service=e}};t.SectorController=c=r.__decorate([(0,n.Crud)({model:{type:l.SectorEntity},params:{slug:{field:"id",type:"uuid",primary:!0}},query:{join:{survey:{eager:!0,allow:["name"],alias:"survey"},"survey.customer":{eager:!0,allow:["name"],alias:"surveyCustomer"}},alwaysPaginate:!0}}),(0,i.UseGuards)(s.JwtAuthGuard),(0,i.Controller)("sectors"),r.__metadata("design:paramtypes",["function"==typeof(o=void 0!==d.SectorService&&d.SectorService)?o:Object])],c)},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.SectorService=void 0;const r=a(4),i=a(1),n=a(9),s=a(35);let l=t.SectorService=class SectorService extends s.TypeOrmCrudService{constructor(e){super(e),this.sectorRepository=e}async findAll(){return this.sectorRepository.find()}};t.SectorService=l=r.__decorate([(0,i.Injectable)(),r.__param(0,(0,i.Inject)("SECTOR_REPOSITORY")),r.__metadata("design:paramtypes",["function"==typeof(o=void 0!==n.Repository&&n.Repository)?o:Object])],l)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sectorProviders=void 0;const o=a(14),r=a(26),i=a(71);t.sectorProviders=[{provide:i.SECTOR_REPOSITORY,useFactory:e=>e.getRepository(o.SectorEntity),inject:[r.DATABASE_CONNECTION]}]},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SECTOR_REPOSITORY=void 0,t.SECTOR_REPOSITORY="SECTOR_REPOSITORY"},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PhotoModule=void 0;const o=a(4),r=a(1),i=a(24),n=a(73),s=a(81),l=a(75);let d=t.PhotoModule=class PhotoModule{};t.PhotoModule=d=o.__decorate([(0,r.Module)({imports:[i.DatabaseModule],providers:[...s.photoProviders,l.PhotoService],exports:[l.PhotoService],controllers:[n.PhotoController]})],d)},(e,t,a)=>{var o,r,i;Object.defineProperty(t,"__esModule",{value:!0}),t.PhotoController=void 0;const n=a(4),s=a(1),l=a(74),d=a(43),c=a(6),p=a(16),m=a(75),u=a(76),y=a(77),_=a(78);let v=t.PhotoController=class PhotoController{constructor(e){this.service=e}async uploadFile(e,t,a){console.log({file:e,entity:t});const o=JSON.parse(a);return await this.service.uploadSave(e?e.filename:null,o)}};n.__decorate([(0,s.Post)("upload"),(0,s.UseInterceptors)((0,l.FileInterceptor)("photo",{storage:(0,y.diskStorage)({destination:(e,t,a)=>{a(null,"../shared/files/seyconel")},filename:_.editFileName}),fileFilter:_.imageFileFilter})),n.__param(0,(0,s.UploadedFile)()),n.__param(1,(0,s.Param)("entity")),n.__param(2,(0,s.Body)("data")),n.__metadata("design:type",Function),n.__metadata("design:paramtypes",["function"==typeof(i=void 0!==u.Express&&void 0!==(r=u.Express.Multer)&&r.File)?i:Object,String,Object]),n.__metadata("design:returntype",Promise)],v.prototype,"uploadFile",null),t.PhotoController=v=n.__decorate([(0,d.Crud)({model:{type:p.PhotoEntity},params:{slug:{field:"id",type:"uuid",primary:!0}},query:{join:{item:{eager:!0,allow:["name"],alias:"item"}},alwaysPaginate:!0}}),(0,s.UseGuards)(c.JwtAuthGuard),(0,s.Controller)("photos"),n.__metadata("design:paramtypes",["function"==typeof(o=void 0!==m.PhotoService&&m.PhotoService)?o:Object])],v)},e=>{e.exports=require("@nestjs/platform-express")},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.PhotoService=void 0;const r=a(4),i=a(1),n=a(9),s=a(35);let l=t.PhotoService=class PhotoService extends s.TypeOrmCrudService{constructor(e){super(e),this.photoRepository=e}async uploadSave(e,t){const{file:a,...o}=t;return await this.photoRepository.save({...o,...e?{file:e}:null})}};t.PhotoService=l=r.__decorate([(0,i.Injectable)(),r.__param(0,(0,i.Inject)("PHOTO_REPOSITORY")),r.__metadata("design:paramtypes",["function"==typeof(o=void 0!==n.Repository&&n.Repository)?o:Object])],l)},e=>{e.exports=require("express")},e=>{e.exports=require("multer")},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.editFileName=t.imageFileFilter=void 0;const o=a(79),r=a(80);t.imageFileFilter=(e,t,a)=>{if(!t.originalname.match(/\.(jpg|jpeg|png|gif)$/))return a(new Error("Only image files are allowed!"),!1);a(null,!0)};t.editFileName=(e,t,a)=>{const i=(0,o.extname)(t.originalname);a(null,`${(0,r.v4)()}${i}`)}},e=>{e.exports=require("path")},e=>{e.exports=require("uuid")},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.photoProviders=void 0;const o=a(16),r=a(26),i=a(82);t.photoProviders=[{provide:i.PHOTO_REPOSITORY,useFactory:e=>e.getRepository(o.PhotoEntity),inject:[r.DATABASE_CONNECTION]}]},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PHOTO_REPOSITORY=void 0,t.PHOTO_REPOSITORY="PHOTO_REPOSITORY"},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EventsModule=void 0;const o=a(4),r=a(1),i=a(19);let n=t.EventsModule=class EventsModule{};t.EventsModule=n=o.__decorate([(0,r.Module)({providers:[i.EventsGateway],exports:[i.EventsGateway]})],n)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReportModule=void 0;const o=a(4),r=a(1),i=a(24),n=a(85),s=a(112),l=a(86);let d=t.ReportModule=class ReportModule{};t.ReportModule=d=o.__decorate([(0,r.Module)({imports:[i.DatabaseModule],providers:[...s.reportProviders,l.ReportService],exports:[...s.reportProviders,l.ReportService],controllers:[n.ReportController]})],d)},(e,t,a)=>{var o,r;Object.defineProperty(t,"__esModule",{value:!0}),t.ReportController=void 0;const i=a(4),n=a(1),s=a(43),l=a(13),d=a(86);let c=t.ReportController=class ReportController{constructor(e){this.service=e}generate(e,t){return this.service.generate(e,t)}async getPDF(e,t){return this.service.pdf(e,t)}};i.__decorate([(0,n.Get)("generate/:surveyId/:ri"),i.__param(0,(0,n.Param)("surveyId")),i.__param(1,(0,n.Param)("ri")),i.__metadata("design:type",Function),i.__metadata("design:paramtypes",[String,String]),i.__metadata("design:returntype",void 0)],c.prototype,"generate",null),i.__decorate([(0,n.Get)("pdf/:reportId"),i.__param(0,(0,n.Response)()),i.__param(1,(0,n.Param)("reportId")),i.__metadata("design:type",Function),i.__metadata("design:paramtypes",[Object,String]),i.__metadata("design:returntype","function"==typeof(r="undefined"!=typeof Promise&&Promise)?r:Object)],c.prototype,"getPDF",null),t.ReportController=c=i.__decorate([(0,s.Crud)({model:{type:l.ReportEntity},params:{slug:{field:"id",type:"uuid",primary:!0}},query:{exclude:["data"],join:{customer:{eager:!0,allow:["name"],alias:"customer"}},alwaysPaginate:!0}}),(0,n.Controller)("reports"),i.__metadata("design:paramtypes",["function"==typeof(o=void 0!==d.ReportService&&d.ReportService)?o:Object])],c)},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.ReportService=void 0;const r=a(4),i=a(1),n=a(9),s=a(35),l=a(12),d=a(87),c=a(88),p=a(89),m=a(107),u=a(108),y=a(109),_=a(110),v=a(111);let g=t.ReportService=class ReportService extends s.TypeOrmCrudService{constructor(e){super(e),this.reportRepository=e,this.counter=0,this.colors={dark:"#0d326f",cyan:"#0099cc",blue:"#0000FF",black:"#000000"},this.lineWidth=.7,this.actualPage="",this.pageTemplatePage=""}async generate(e,t){const a=this.reportRepository.manager.getRepository(l.SurveyEntity);await a.update({id:e},{completed:!0});const o=await a.createQueryBuilder("surveys").leftJoinAndSelect("surveys.customer","customer").leftJoinAndSelect("surveys.sectors","sectors").leftJoinAndSelect("sectors.items","items").leftJoinAndSelect("items.photos","photos").select(["surveys.id","surveys.name","customer.id","customer.name","customer.cnpj","sectors.id","sectors.name","items.id","items.traceability","items.data","items.approved","photos.id","photos.file"]).where({id:e}).getOne();o&&await this.reportRepository.save({name:o?.name,surveyId:e,data:o,ri:Number(t)})}zeroPad(e,t){return String(e).padStart(t,"0")}async pdf(e,t){const a=`${m.staticPath}/${t}.pdf`,o=`${m.staticPath}/${t}-src.pdf`;try{if(y.existsSync(a)){console.log("file exists",a);const t=y.createReadStream(a);return t.on("open",(function(){e.set({"Content-Type":"application/pdf"}),t.pipe(e)})),!0}}catch(_){console.error(_)}const r=await this.reportRepository.findOne({where:{id:t}}),i=new d({size:"A4",autoFirstPage:!1,margins:{top:163,bottom:-120,left:0,right:0}}),n=r?.data,s=n.sectors;console.log("setores: ",s.length);let l={docNumber:`RI-${this.zeroPad(r.ri,4)}`,docDate:(0,c.format)(r.createdAt,"dd/MM/yy"),sectorName:"Acess\xf3rios de movimenta\xe7\xe3o e I\xe7amento de carga"},u=0;for(const d of s){0===u&&i.on("pageAdded",(async e=>{await this.pageTemplate(i,l)})),u++,console.log("setor: ",u);const e=d?.items?[...d.items]:[];if(console.log("items: ",e.length),e.length>0){this.sector=d,this.actualPage="sectorPage",i.addPage(),l={...l,docDate:(0,c.format)(r.createdAt,"dd/MM/yy"),sectorName:d?.name,items:e},await this.sectorPage(i,l);for(const t of e){this.actualPage="itemPage",i.addPage();const e=p.ItemTypes.find((e=>e.itemType===t?.data?.type));l={...l,photos:t?.photos,content:e.renderContent(t,d),approved:t?.approved},await this.itemPage(i,l)}}}console.log("document done"),e.set({"Content-Type":"application/pdf"}),i.pipe(y.createWriteStream(o)).on("finish",(()=>{console.log("PDF writed",o),this.compressAndMove(t)})),i.pipe(e),i.end()}async compressAndMove(e){const t=_.version();console.log(t),_.executeSync(`-sDEVICE=pdfwrite -dPDFSETTINGS=/printer -o ${m.staticPath}/${e}.pdf -sDEVICE=pdfwrite -r70 ${m.staticPath}/${e}-src.pdf`),y.rmSync(`${m.staticPath}/${e}-src.pdf`)}async pageTemplate(e,t){"sectorPage"===this.actualPage&&"sectorPage"===this.pageTemplatePage&&e.fontSize(24).font("Helvetica").fillColor(this.colors.black).text(`${t.sectorName}`,50,120,{width:500,align:"center",lineGap:15}),this.pageTemplatePage=this.actualPage;const a=23;let o=[a,a,817,571.5];const r=__dirname;e.image(`${r}/assets/logo.png`,42,31,{width:105}),e.font("Helvetica"),e.polygon([o[0],o[1]],[o[0],o[2]],[o[3],o[2]],[o[3],o[1]]).lineWidth(this.lineWidth).stroke(this.colors.dark);o=[47,36.5,87,548.5],e.polygon([o[0],o[1]],[o[0],o[2]],[o[3],o[2]],[o[3],o[1]]).lineWidth(this.lineWidth).stroke(this.colors.dark),o[0]=142,e.polygon([o[0],o[1]],[o[0],o[2]]).lineWidth(this.lineWidth).stroke(this.colors.dark),o[0]=450,e.polygon([o[0],o[1]],[o[0],o[2]]).stroke(this.colors.dark),o[0]=496.5,e.polygon([o[0],o[1]],[o[0],o[2]]).stroke(this.colors.dark),o[0]=142,e.polygon([o[0],62],[o[3],62]).lineWidth(this.lineWidth).stroke(this.colors.dark),e.fontSize(9).font("Helvetica-Bold").fillColor(this.colors.dark).text("RELAT\xd3RIO DE INSPE\xc7\xc3O \u2013 DEPARTAMENTO DE ENGENHARIA",o[0],46,{width:308,align:"center"}),e.fontSize(9).font("Helvetica").fillColor(this.colors.dark).text(`${t.sectorName}`.toLocaleUpperCase(),o[0],71,{width:308,align:"center"}),e.fontSize(9).fillColor(this.colors.dark).font("Helvetica-Bold").text("N\xba DOC:",450,46,{width:47,align:"center"}),e.fontSize(9).fillColor(this.colors.dark).font("Helvetica-Bold").text("DATA:",450,71,{width:47,align:"center"}),e.fontSize(10).font("Helvetica-Bold").fillColor(this.colors.blue).text(`${t.docNumber}`,496,46,{width:52,align:"center"}),e.fontSize(10).font("Helvetica-Bold").fillColor(this.colors.cyan).text(`${t.docDate}`,496,71,{width:52,align:"center"})}async itemPage(e,t){if(console.log("itemPage",this.counter++),e.fontSize(12).font("Helvetica").fillColor(this.colors.black).text(`${t.content[0]}`,60,110,{width:480,align:"left",lineGap:6}),e.fontSize(12).font("Helvetica").fillColor(this.colors.black).text(`${t.content[1]}`,60,110,{width:480,align:"right",lineGap:6}),e.fontSize(12).font("Helvetica").fillColor(this.colors.black).text(`( ${t?.approved?"X":" "} ) APROVADO      ( ${t?.approved?" ":"X"} ) REPROVADO`,60,360,{width:500,align:"left",lineGap:0}),t?.photos&&t?.photos.length>0){let a=60,o=a+10,r=[47,760,a,548.5];const i=t?.photos.reduce(((e,t,a)=>(a%4?e[e.length-1].push(t):e.push([t]))&&e),[]);for(const[t,n]of i.entries())switch(a+=364,t%2==1&&(e.addPage(),a=90),o=a+10,r=[47,360+a,a,548.5],e.polygon([r[0],r[1]],[r[0],r[2]],[r[3],r[2]],[r[3],r[1]]).lineWidth(this.lineWidth).stroke(this.colors.dark),n.length){case 1:e.image(`${m.staticPath}/${n[0].file}`,57,o,{width:480,height:340,cover:[480,340],fit:[480,340],align:"center",valign:"center"});break;case 2:e.image(`${m.staticPath}/${n[0].file}`,57,o,{width:240,height:340,align:"center",valign:"center",fit:[240,340]}),e.image(`${m.staticPath}/${n[1].file}`,297,o,{width:240,height:340,fit:[240,340],align:"center",valign:"center"});break;case 3:e.image(`${m.staticPath}/${n[0].file}`,57,o,{width:240,height:340,align:"center",valign:"center",fit:[240,340]}),e.image(`${m.staticPath}/${n[1].file}`,297,o,{width:240,height:190,cover:[240,170],fit:[240,170],align:"center",valign:"center"}),e.image(`${m.staticPath}/${n[2].file}`,297,o+170,{width:240,height:340,cover:[240,170],fit:[240,170],align:"center",valign:"center"});break;case 4:e.image(`${m.staticPath}/${n[0].file}`,57,o,{width:240,height:170,cover:[240,170],fit:[240,170],align:"center",valign:"center"}),e.image(`${m.staticPath}/${n[1].file}`,57,o+170,{width:240,height:170,cover:[240,170],fit:[240,170],align:"center",valign:"center"}),e.image(`${m.staticPath}/${n[2].file}`,297,o,{width:240,height:170,cover:[240,170],fit:[240,170],align:"center",valign:"center"}),e.image(`${m.staticPath}/${n[3].file}`,297,o+170,{width:240,height:170,cover:[240,170],fit:[240,170],align:"center",valign:"center"})}}}async sectorPage(e,t){console.log("sectorPage: ",t?.sectorName),e.fontSize(24).font("Helvetica").fillColor(this.colors.black).text(`${t.sectorName}`,50,120,{width:500,align:"center",lineGap:15});const a={headers:[{label:"Num. Rastreio",headerColor:"yellow",headerOpacity:1},{label:"Descri\xe7\xe3o",headerColor:"yellow",headerOpacity:1},{label:"Capacidade",headerColor:"yellow",headerOpacity:1},{label:"Comprimento",headerColor:"yellow",headerOpacity:1},{label:"Situa\xe7\xe3o",headerColor:"yellow",headerOpacity:1}],rows:t.items.map((e=>[e?.traceability,e?.data?.description,e?.data?.capacity?e?.data?.capacity:e?.data?.capacity_select?e?.data?.capacity_select:e?.data?.capacity_auto,e?.data?.length,e?.approved?"Aprovado":"Reprovado"]))};e.table(a,{width:500,columnsSize:[80,210,80,80,50]});const{aprovados:o,reprovados:r}=t.items.reduce(((e,t)=>(t.approved?e.aprovados++:e.reprovados++,e)),{aprovados:0,reprovados:0});let i=e.y+10;e.y>600&&(e.addPage(),i=200);const n=await this.generateImageChart2(o,r);e.image(n,50,i,{width:500,height:250,align:"center",valign:"center"});const s=await this.generateImageChart(o,r);e.image(s,50,i+280,{width:500,height:250,align:"center",valign:"center"})}async generateImageChart(e,t){const a=`\n      // Create the data table.\n      var data = new google.visualization.DataTable();\n      data.addColumn('string', '');\n      data.addColumn('number', '');\n      data.addRows([\n        ['Aprovados', ${e}],\n        ['Reprovados', ${t}],\n      ]);\n      // Set chart options\n      var options = { title: 'Gr\xe1fico de conclus\xe3o' };\n      // Instantiate and draw our chart, passing in some options.\n      var chart = new google.visualization.PieChart(document.getElementById('chart_div'));\n      chart.draw(data, options);\n    `;return await v.render(a,{width:500,height:250})}async generateImageChart2(e,t){const a=`\n      // Create the data table.\n      var data = new google.visualization.DataTable();\n      data.addColumn('string', '');\n      data.addColumn('number', '');\n      data.addRows([\n        ['Total', ${e+t}],\n        ['Aprovados', ${e}],\n        ['Reprovados', ${t}],\n      ]);\n      // Set chart options\n      var options = { title: 'Gr\xe1fico de conclus\xe3o' };\n      // Instantiate and draw our chart, passing in some options.\n      var chart = new google.visualization.BarChart(document.getElementById('chart_div'));\n      chart.draw(data, options);\n    `;return await v.render(a,{width:500,height:250})}generateBars(e,t){return u("bar",{labels:["Total","Aprovados","Reprovados"],series:[[e+t,e,t]]})}generatePie(e,t){const a={labels:["Aprovados","Reprovados"],series:[[e,t]]};return u("pie",a)}};t.ReportService=g=r.__decorate([(0,i.Injectable)(),r.__param(0,(0,i.Inject)("REPORT_REPOSITORY")),r.__metadata("design:paramtypes",["function"==typeof(o=void 0!==n.Repository&&n.Repository)?o:Object])],g)},e=>{e.exports=require("pdfkit-table")},e=>{e.exports=require("date-fns")},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=a(4);o.__exportStar(a(90),t),o.__exportStar(a(92),t),o.__exportStar(a(94),t),o.__exportStar(a(93),t),o.__exportStar(a(100),t),o.__exportStar(a(99),t),o.__exportStar(a(95),t),o.__exportStar(a(101),t),o.__exportStar(a(102),t),o.__exportStar(a(96),t),o.__exportStar(a(103),t),o.__exportStar(a(104),t),o.__exportStar(a(105),t),o.__exportStar(a(106),t)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ItemDataFields=t.ItemDataFieldLegends=t.ItemTypes=t.simNao=void 0;const o=a(91);t.simNao=e=>e?"Sim":"N\xe3o",t.ItemTypes=[{name:"Linga de Cabo de A\xe7o",itemType:1,renderContent:(e,a)=>{const o=a?.name;return[`Linga de Cabo de A\xe7o\nPlaca de rastreabilidade Seyconel: ${e?.traceability}\nSetor: ${o}\nComprimento: ${e?.data?.length} m\nElemento inicial: ${e?.data?.initial_element}                 Elemento de liga\xe7\xe3o: ${e?.data?.connection_element}                 Elemento final: ${e?.data?.end_element}\nIdent.decargaleg\xedvel: ${(0,t.simNao)(e?.data?.legible_load_id)}\nRuptura de pernas: ${(0,t.simNao)(e?.data?.leg_break)}\nAmassados: ${(0,t.simNao)(e?.data?.crumpled)}\nDesgastes excessivos: ${(0,t.simNao)(e?.data?.excessive_wear)}\nRedu\xe7\xe3o de elasticidade: ${(0,t.simNao)(e?.data?.elasticity_reduction)}\nDescri\xe7\xe3o: ${e?.data?.description}\nObserva\xe7\xe3o: ${e?.data?.observation?e?.data?.observation:""}\n      `,`\nRamais: ${e?.data?.extensions}\nCapacidade: ${e?.data?.capacity} T\nDi\xe2metro: ${e?.data?.diameter} mm\n\nArames rompidos:${(0,t.simNao)(e?.data?.broken_wire)}\n\nDeforma\xe7\xe3o: ${(0,t.simNao)(e?.data?.deformation)}\nDanos por calor: ${(0,t.simNao)(e?.data?.heat_damage)}\nCorros\xe3o externa/interna: ${(0,t.simNao)(e?.data?.corrosion)}`]},fields:["extensions","capacity","length","diameter","initial_element","connection_element","end_element","legible_load_id","broken_wire","leg_break","crumpled","deformation","excessive_wear","heat_damage","elasticity_reduction","corrosion","description","observation"]},{name:"Dispositivos Especiais",itemType:2,renderContent:(e,a)=>{const o=a?.name;return[`Dispositivos Especiais\nPlaca de rastreabilidade Seyconel: ${e?.traceability}\nSetor: ${o}\nComprimento: ${e?.data?.length} m\nOlhal danificado: ${(0,t.simNao)(e?.data?.eyelet_damage)}\nAlavanca danificada: ${(0,t.simNao)(e?.data?.lever_damage)}\nTrinca nas soldas: ${(0,t.simNao)(e?.data?.weld_cracks)}\n\nDescri\xe7\xe3o: ${e?.data?.description}\nObserva\xe7\xe3o: ${e?.data?.observation?e?.data?.observation:""}`,`\nCapacidade: ${e?.data?.capacity} T\nTara: ${e?.data?.tare} kg\nEstrutura externa danificada: ${(0,t.simNao)(e?.data?.external_structure_damage)}\nBase inferior danificada: ${(0,t.simNao)(e?.data?.lower_base_damage)}\nEnsaios n\xe3o destrutivos: ${(0,t.simNao)(e?.data?.non_destructive_testing)}\n`]},fields:["length","capacity","tare","eyelet_damage","external_structure_damage","lever_damage","lower_base_damage","documentation","welds_cracks","description","observation"]},{name:"Garras de eleva\xe7\xe3o",itemType:3,renderContent:(e,a)=>{const o=a?.name;return[`Garras de eleva\xe7\xe3o\nPlaca de rastreabilidade Seyconel: ${e?.traceability}\nSetor: ${o}\nCame danificado: ${(0,t.simNao)(e?.data?.came_damage)}\nPinos danificados: ${(0,t.simNao)(e?.data?.pine_damage)}\n\nDescri\xe7\xe3o: ${e?.data?.description}\nObserva\xe7\xe3o: ${e?.data?.observation?e?.data?.observation:""}`,`\nCapacidade: ${e?.data?.capacity} T\nDeforma\xe7\xe3o: ${(0,t.simNao)(e?.data?.deformation)}\nOlhal danificado: ${(0,t.simNao)(e?.data?.eyelet_damage)}\nDano na trava: ${(0,t.simNao)(e?.data?.latch_damage)}\n`]},fields:["capacity","deformation","eyelet_damage","latch_damage","came_damage","pine_damage","description","observation"]},{name:"Acess\xf3rios",itemType:4,renderContent:(e,a)=>{const o=a?.name;return[`Acess\xf3rios\nPlaca de rastreabilidade Seyconel: ${e?.traceability}\nSetor: ${o}\nGrau: ${e?.data?.degree}\nIdentifica\xe7\xe3o: ${(0,t.simNao)(e?.data?.identification)}\nAlongamento: ${(0,t.simNao)(e?.data?.stretching)}\n\nDescri\xe7\xe3o: ${e?.data?.description}\nObserva\xe7\xe3o: ${e?.data?.observation?e?.data?.observation:""}`,`\n\nCapacidade: ${e?.data?.capacity} T\nDeforma\xe7\xe3o: ${(0,t.simNao)(e?.data?.deformation)}\nTravas: ${(0,t.simNao)(e?.data?.latches)}\nTrincas: ${(0,t.simNao)(e?.data?.cracks)}\n`]},fields:["capacity","degree","identification","deformation","stretching","latches","cracks","description","observation"]},{name:"Eslingas",itemType:5,renderContent:(e,a)=>{const o=a?.name;return[`Eslingas\nPlaca de rastreabilidade Seyconel: ${e?.traceability}\nSetor: ${o}\nElemento inicial: ${e?.data?.initial_element}                 Elemento de liga\xe7\xe3o: ${e?.data?.connection_element}                 Elemento final: ${e?.data?.end_element}\nDanos costura do corpo: ${(0,t.simNao)(e?.data?.body_seam_damage)}\nCortes: ${(0,t.simNao)(e?.data?.cuts)}\nTravas: ${(0,t.simNao)(e?.data?.latches)}\nTrinca: ${(0,t.simNao)(e?.data?.cracks)}\nPlaca de Identifica\xe7\xe3o: ${(0,t.simNao)(e?.data?.nameplate)}\n\nDescri\xe7\xe3o: ${e?.data?.description}\nObserva\xe7\xe3o: ${e?.data?.observation?e?.data?.observation:""}`,`\nRamais: ${e?.data?.extensions}\nCapacidade cinta: ${e?.data?.strap_capacity}\n\nDanos nos olhais: ${(0,t.simNao)(e?.data?.eyelets_damage)}\nDanos costura principal: ${(0,t.simNao)(e?.data?.main_seam_damage)}\nAbras\xe3o: ${(0,t.simNao)(e?.data?.abrasion)}\nDeforma\xe7\xe3o: ${(0,t.simNao)(e?.data?.deformation)}\nAlongamento: ${(0,t.simNao)(e?.data?.stretching)}\n\n`]},fields:["extensions","strap_type","initial_element","connection_element","end_element","length","strap_capacity","capacity_auto","body_seam_damage","main_seam_damage","eyelets_damage","abrasion","deformation","stretching","cuts","latches","cracks","nameplate","description","observation"]},{name:"Lingas",itemType:6,renderContent:(e,a)=>{const o=a?.name;return[`Lingas\nPlaca de rastreabilidade Seyconel: ${e?.traceability}\nSetor: ${o}\nElemento inicial: ${e?.data?.initial_element}                 Elemento de liga\xe7\xe3o: ${e?.data?.connection_element}                 Elemento final: ${e?.data?.end_element}\nGrau a\xe7o: ${e?.data?.degree_iron}\nAlongamento interno da corrente: ${(0,t.simNao)(e?.data?.internal_stretching)}\nAlongamento externo da corrente: ${(0,t.simNao)(e?.data?.external_stretching)}\nCapacidade: ${e?.data?.capacity_auto}\nDeforma\xe7\xe3o:  ${(0,t.simNao)(e?.data?.deformation)}\nDescri\xe7\xe3o: ${e?.data?.description}\nObserva\xe7\xe3o: ${e?.data?.observation?e?.data?.observation:""}`,`\nComprimento: ${e?.data?.length} m\nRamais: ${e?.data?.extensions}\n\nTravas: ${(0,t.simNao)(e?.data?.latches)}\nTrinca: ${(0,t.simNao)(e?.data?.cracks)}\nPlaca de Identifica\xe7\xe3o: ${(0,t.simNao)(e?.data?.nameplate)}\n\n\n`]},fields:["extensions","length","initial_element","connection_element","end_element","nominal_diameter","capacity_auto","degree_iron","internal_stretching","external_stretching","latches","cracks","deformation","nameplate","description","observation"]},{name:"Cintas",itemType:7,renderContent:(e,a)=>{const o=a?.name;return[`Cintas\nPlaca de rastreabilidade Seyconel: ${e?.traceability}\nSetor: ${o}\nCapacidade: ${e?.data?.capacity_select}\nTipo de cinta: ${e?.data?.strap_type}\nDanos na costura do corpo: ${(0,t.simNao)(e?.data?.body_seam_damage)}\nDanos nos olhais: ${(0,t.simNao)(e?.data?.eyelets_damage)}\nCortes: ${(0,t.simNao)(e?.data?.cuts)}\n\nDescri\xe7\xe3o: ${e?.data?.description}\nObserva\xe7\xe3o: ${e?.data?.observation?e?.data?.observation:""}`,`\nComprimento: ${e?.data?.length} m\nRamais: ${e?.data?.extensions}\n\nDanos na costura principal: ${(0,t.simNao)(e?.data?.main_seam_damage)}\nAbras\xe3o: ${(0,t.simNao)(e?.data?.abrasion)}\nPlaca de Identifica\xe7\xe3o: ${(0,t.simNao)(e?.data?.nameplate)}\n\n\n`]},fields:["extensions","capacity_select","length","strap_type","body_seam_damage","main_seam_damage","eyelets_damage","cuts","abrasion","nameplate","description","observation"]},{name:"Talhas manuais",itemType:8,renderContent:(e,a)=>{const o=a?.name;return[`Talhas manuais\nPlaca de rastreabilidade Seyconel: ${e?.traceability}\nSetor: ${o}\nCapacidade: ${e?.data?.capacity} T\n\nGancho danificado: ${(0,t.simNao)(e?.data?.hook_damaged)}\nAlavanca danificada: ${(0,t.simNao)(e?.data?.lever_damage)}\nTrinca nas soldas: ${(0,t.simNao)(e?.data?.welds_cracks)}\nDeforma\xe7\xe3o nos elos da corrente: ${(0,t.simNao)(e?.data?.chain_links_deformation)}\n\nDescri\xe7\xe3o: ${e?.data?.description}\nObserva\xe7\xe3o: ${e?.data?.observation?e?.data?.observation:""}`,`\n\nComprimento: ${e?.data?.length} m\n\nEstrutura externa danificada: ${(0,t.simNao)(e?.data?.external_structure_damage)}\nPinos danificados: ${(0,t.simNao)(e?.data?.pine_damage)}\nTravas: ${(0,t.simNao)(e?.data?.latches)}\n`]},fields:["length","capacity","hook_damaged","external_structure_damage","lever_damage","welds_cracks","pine_damage","chain_links_deformation","latches","description","observation"]},{name:"Cabo de A\xe7o",itemType:9,renderContent:(e,a)=>{const o=a?.name;return[`Cabo de A\xe7o\nPlaca de rastreabilidade Seyconel: ${e?.traceability}\nSetor: ${o}\nComprimento: ${e?.data?.length} m\n\nIdent.de carga leg\xedvel: ${(0,t.simNao)(e?.data?.legible_load_id)}\nRuptura de pernas: ${(0,t.simNao)(e?.data?.leg_break)}\nAmassados: ${(0,t.simNao)(e?.data?.crumpled)}\nDesgastes excessivos: ${(0,t.simNao)(e?.data?.excessive_wear)}\nRedu\xe7\xe3o de elasticidade: ${(0,t.simNao)(e?.data?.elasticity_reduction)}\nDescri\xe7\xe3o: ${e?.data?.description}\nObserva\xe7\xe3o: ${e?.data?.observation?e?.data?.observation:""}\n      `,`\nRamais: ${e?.data?.extensions}\nCapacidade: ${e?.data?.capacity} T\nDi\xe2metro: ${e?.data?.diameter} mm\n\nArames rompidos:${(0,t.simNao)(e?.data?.broken_wire)}\n\nDeforma\xe7\xe3o: ${(0,t.simNao)(e?.data?.deformation)}\nDanos por calor: ${(0,t.simNao)(e?.data?.heat_damage)}\nCorros\xe3o externa/interna: ${(0,t.simNao)(e?.data?.corrosion)}`]},fields:["extensions","capacity","length","diameter","legible_load_id","broken_wire","leg_break","crumpled","excessive_wear","deformation","elasticity_reduction","heat_damage","corrosion","description","observation"]}],t.ItemDataFieldLegends={ELO:"Elo de sustenta\xe7\xe3o",ESE:"Elos com sub elos",CAD:"Cadeado",CAC:"Cadeado para cinta",MPC:"Manilha ancora com porca e cupilha",MAR:"Manilha ancora com rosca",GEF:"Gancho especial de fundi\xe7\xe3o",GOT:"Gancho olhal com trava",GOA:"Gancho olhal auto-travante",SEP:"Separador de Perfil",DIS:"Dispositivo Especial",GCT:"Gancho cl\xe9vis com trava",GCA:"Gancho cl\xe9vis auto-travante",GGA:"Gancho girat\xf3rio auto-travante",GOF:"Gancho Olhal de Fundi\xe7\xe3o",ENC:"Encurtador de corrente",OG:"Olhal girat\xf3rio",OA:"Olhal articulado",OF:"Olhal fixo",PCH:"Pega chapa Horizontal",PCV:"Pega chapa Vertical",PV:"Pega Viga",PTB:"Pega Tambor"},t.ItemDataFields={sector:{label:"Setor",type:"input"},length:{label:"Comprimento",type:"input"},extensions:{label:"Ramais",type:"select-modal",options:[{label:"Ramal 1",value:1},{label:"Ramal 2",value:2},{label:"Ramal 3",value:3},{label:"Ramal 4",value:4}]},strap_capacity:{label:"Capacidade cinta",type:"select-modal",options:[{label:"1 T",value:1},{label:"2 T",value:2},{label:"3 T",value:3},{label:"4 T",value:4},{label:"5 T",value:5},{label:"6 T",value:6},{label:"8 T",value:8},{label:"10 T",value:10},{label:"12 T",value:12},{label:"15 T",value:15},{label:"20 T",value:20}]},strap_type:{label:"Tipo de cinta",type:"select-modal",options:[{label:"Plana",value:"plana"},{label:"Anel",value:"anel"},{label:"Tubular",value:"tubular"}]},degree:{label:"Grau",type:"select-modal",options:[{label:"6",value:6},{label:"8",value:8},{label:"10",value:10},{label:"12",value:12}]},degree_iron:{label:"Grau a\xe7o",type:"select-modal",options:[{label:"G8: Grau 8",value:8},{label:"G10: Grau 10",value:10}]},nominal_diameter:{label:"Di\xe2metro nominal da corrente",type:"select-modal",options:Object.keys(o.ItemCapacityDataEslinga8).map((e=>({label:`${e}mm`,value:Number(e)})))},capacity_select:{label:"Capacidade",type:"select-modal",options:[{label:"1 T",value:1},{label:"2 T",value:2},{label:"3 T",value:3},{label:"4 T",value:4},{label:"5 T",value:5},{label:"6 T",value:6},{label:"8 T",value:8},{label:"10 T",value:10},{label:"12 T",value:12},{label:"15 T",value:15},{label:"18 T",value:18},{label:"20 T",value:20}]},capacity:{label:"Capacidade",type:"input"},capacity_auto:{label:"Capacidade",type:"input",templateOptions:{readonly:!0}},tare:{label:"Tara",type:"input"},initial_element:{label:"Elemento inicial",type:"select-modal",options:Object.keys(t.ItemDataFieldLegends).map((e=>({label:`${e} - ${t.ItemDataFieldLegends[e]}`,value:e})))},connection_element:{label:"Elemento de liga\xe7\xe3o",type:"select-modal",options:Object.keys(t.ItemDataFieldLegends).map((e=>({label:`${e} - ${t.ItemDataFieldLegends[e]}`,value:e})))},end_element:{label:"Elemento final",type:"select-modal",options:Object.keys(t.ItemDataFieldLegends).map((e=>({label:`${e} - ${t.ItemDataFieldLegends[e]}`,value:e})))},diameter:{label:"Di\xe2metro",type:"input"},corrosion:{label:"Corros\xe3o interna/externa",type:"toggle"},internal_stretching:{label:"Alongamento interno da corrente",type:"toggle"},external_stretching:{label:"Alongamento externo da corrente",type:"toggle"},deformation:{label:"Deforma\xe7\xe3o",type:"toggle"},chain_links_deformation:{label:"Deforma\xe7\xe3o nos elos da corrente",type:"toggle"},identification:{label:"Identifica\xe7\xe3o",type:"toggle"},stretching:{label:"Alongamento",type:"toggle"},latches:{label:"Travas",type:"toggle"},cracks:{label:"Trincas",type:"toggle"},welds_cracks:{label:"Trincas nas soldas",type:"toggle"},nameplate:{label:"Placa de identifica\xe7\xe3o",type:"toggle"},eyelets_damage:{label:"Danos nos olhais",type:"toggle"},eyelet_damage:{label:"Olhal danificado",type:"toggle"},body_seam_damage:{label:"Danos costura do corpo",type:"toggle"},main_seam_damage:{label:"Danos costura principal",type:"toggle"},came_damage:{label:"Came danificado",type:"toggle"},pine_damage:{label:"Pinos Danificado",type:"toggle"},latch_damage:{label:"Dano na trava",type:"toggle"},cuts:{label:"Cortes",type:"toggle"},abrasion:{label:"Abras\xe3o",type:"toggle"},external_structure_damage:{label:"Estrutura externa danificada",type:"toggle"},lever_damage:{label:"Alavanca danificada",type:"toggle"},lower_base_damage:{label:"Base inferior danificada",type:"toggle"},technical_drawing:{label:"Desenho t\xe9cnico",type:"toggle"},measures_match_drawing:{label:"Medidas batem com desenho",type:"toggle"},eyelet_fine:{label:"Olhal em bom estado",type:"toggle"},legible_load_id:{label:"Ident. de carga leg\xedvel",type:"toggle"},broken_wire:{label:"Arames rompidos",type:"toggle"},documentation:{label:"Documenta\xe7\xe3o",type:"toggle"},leg_break:{label:"Ruptura de pernas",type:"toggle"},crumpled:{label:"Amassados",type:"toggle"},excessive_wear:{label:"Desgastes excessivos",type:"toggle"},hook_damaged:{label:"Gancho danificado",type:"toggle"},heat_damage:{label:"Danos por calor",type:"toggle"},elasticity_reduction:{label:"Redu\xe7\xe3o de elasticidade",type:"toggle"},observation:{label:"Observa\xe7\xe3o",type:"textarea"},non_destructive_testing:{label:"Ensaios n\xe3o destrutivos",type:"toggle"},description:{label:"Descri\xe7\xe3o",type:"textarea"}}},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ItemCapacityData=t.ItemCapacityDataLinga=t.ItemCapacityDataEslinga=t.ItemCapacityDataEslinga10=t.ItemCapacityDataEslinga8=void 0,t.ItemCapacityDataEslinga8={6:{1:1120,2:1600,3:2360},7:{1:1500,2:2120,3:3150},8:{1:2e3,2:2800,3:4250},10:{1:3150,2:4250,3:6700},13:{1:5300,2:7500,3:11200},16:{1:8e3,2:11200,3:17e3},18:{1:1e4,2:14e3,3:21200},20:{1:12500,2:17e3,3:26500},22:{1:15e3,2:21200,3:31500},26:{1:21200,2:3e4,3:45e3},32:{1:31500,2:15e3,3:67e3}},t.ItemCapacityDataEslinga10={6:{1:1400,2:2e3,3:3e3},7:{1:1900,2:2650,3:4e3},8:{1:2500,2:3550,3:5300},10:{1:4e3,2:5600,3:8e3},13:{1:6700,2:9500,3:14e3},16:{1:1e4,2:14e3,3:21200},19:{1:14e3,2:2e4,3:30200},22:{1:19e3,2:26500,3:40200}},t.ItemCapacityDataEslinga={8:t.ItemCapacityDataEslinga8,10:t.ItemCapacityDataEslinga10},t.ItemCapacityDataLinga={1:{1:1e3,2:1400,3:2100},2:{1:2e3,2:2800,3:4200},3:{1:3e3,2:4200,3:6300},4:{1:4e3,2:5600,3:8400},5:{1:5e3,2:7e3,3:10500},6:{1:6e3,2:8400,3:12600},8:{1:8e3,2:11200,3:16800},10:{1:1e4,2:14e3,3:21e3},12:{1:12e3,2:16800,3:25200},15:{1:15e3,2:21e3,3:31500},20:{1:2e4,2:28e3,3:42e3}},t.ItemCapacityData={}},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.appConfig=void 0;const o=a(93),r=a(95),i=a(96),n=a(97),s=a(99),l=a(100),d=a(101);t.appConfig={title:"Seyconel",subtitle:"Inspe\xe7\xf5es T\xe9cnicas",entities:{...o.customerEntity,...l.surveyEntity,...s.sectorEntity,...r.itemEntity,...i.photoEntity,...d.userEntity,...n.reportEntity}}},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.customerEntity=void 0;const o=a(94),r=[{key:"name",type:"input",templateOptions:{...o.iaDefaultField.templateOptions,label:"Nome",placeholder:"Preencha o nome completo",required:!0}},{key:"cnpj",type:"input",templateOptions:{...o.iaDefaultField.templateOptions,label:"CNPJ",placeholder:"Preencha um CNPJ v\xe1lido",required:!0}}],i=[{key:"name",type:"input",templateOptions:{...o.iaDefaultField.templateOptions,label:"Nome",placeholder:"Preencha o nome completo"}},{key:"cnpj",type:"input",templateOptions:{...o.iaDefaultField.templateOptions,label:"CNPJ",placeholder:"Preencha um CNPJ v\xe1lido"}}];t.customerEntity={customers:{id:"customers",label:"Clientes",labelSingular:"Cliente",keyField:"id",displayField:"name",icon:"briefcase",actions:["list","detail","add","edit","remove","export","search","filter"],search:e=>({$or:[{name:{$cont:e}},{cnpj:{$cont:e}}]}),filters:{fields:i},form:{fields:r},appForm:{fields:r},list:{columns:[{name:"Nome",prop:"name"},{name:"CNPJ",prop:"cnpj"},{name:"Vistorias",prop:"surveysCount",maxWidth:80,cellClass:"ion-text-center"}]},detail:{fields:[{name:"Nome",prop:"name"},{name:"CNPJ",prop:"cnpj"},{name:"Vistorias",prop:"surveysCount",url:e=>`/admin/surveys/list?customerId=${e.id}`},{name:"Criado em",prop:"createdAt",render:e=>e},{name:"Atualizado em",prop:"modifiedAt",render:e=>e}]}}}},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.iaDefaultField=void 0,t.iaDefaultField={templateOptions:{labelPosition:"stacked"}}},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.itemEntity=void 0;const o=a(94),r=a(89),i=a(22),n=a(91),s=[{key:"traceability",type:"input",templateOptions:{...o.iaDefaultField.templateOptions,label:"Placa de rastreabilidade Seyconel",placeholder:"Preencha a rastreabilidade"}},{key:"sector.id",type:"select-modal",templateOptions:{...o.iaDefaultField.templateOptions,label:"Setor",required:!0,dynamicOptions:{entityId:"sectors",group:"survey.name",label:"name",value:"id"}}},{key:"data.type",type:"select-modal",templateOptions:{...o.iaDefaultField.templateOptions,label:"Tipo de Item",required:!0,options:r.ItemTypes,valueProp:"itemType",labelProp:"name"}},{key:"approved",type:"toggle",templateOptions:{...o.iaDefaultField.templateOptions,label:"Aprovado?",required:!1}},...Object.keys(r.ItemDataFields).map((e=>{const t=r.ItemDataFields[e],a=["nominal_diameter","extensions","degree_iron","strap_capacity","initial_element","strap_type","strap_capacity","end_element","length","capacity_select","diameter","capacity"].indexOf(e)>-1?{onInit:e=>{if(!e||!e?.formControl)return;const t=t=>{const a=e?.formControl?.parent?.get("extensions")?.value,o=e?.formControl?.parent?.get("strap_capacity")?.value,r=e?.formControl?.parent?.get("nominal_diameter")?.value,i=e?.formControl?.parent?.get("degree_iron")?.value,s=e?.formControl?.parent?.get("type")?.value;if(console.log("calcTable",{type:s,nominal_diameter:r,extensions:a,degree_iron:i,strap_capacity:o}),6!==s)if(5!==s){if(7===s)try{const t=["strap_type","length","capacity_select"];let a="";const o={length:"m",capacity_select:"T"},r={strap_type:"Cinta "};for(const i of t){const t=e?.formControl?.parent?.get(i)?.value;if(t){const e=o[i]?o[i]:"";a+=`${r[i]?r[i]:""}${t}${e}, `}}a=a.slice(0,-2),e?.formControl?.parent?.get("description")?.setValue(a)}catch(l){e?.formControl?.parent?.get("description")?.setValue("")}if(9===s)try{const t=["diameter","length","capacity"];let a="Cabo de a\xe7o, ";const o={diameter:"mm",length:"m",capacity:"T"};for(const r of t){const t=e?.formControl?.parent?.get(r)?.value;if(t){a+=`${t}${o[r]?o[r]:""}, `}}a=a.slice(0,-2),e?.formControl?.parent?.get("description")?.setValue(a)}catch(l){e?.formControl?.parent?.get("description")?.setValue("")}if(1===s)try{const t=["initial_element","extensions","","diameter","end_element","length","capacity"];let a="";const o={diameter:"mm",length:"m",capacity:"T",extensions:"R"};for(const r of t)if(""!==r){const t=e?.formControl?.parent?.get(r)?.value;if(t){a+=`${t}${o[r]?o[r]:""}, `}}else a+="Cabo de a\xe7o, ";a=a.slice(0,-2),e?.formControl?.parent?.get("description")?.setValue(a)}catch(l){e?.formControl?.parent?.get("description")?.setValue("")}}else{if(o&&a)try{const t=n.ItemCapacityDataLinga[o][4===a?3:a];e?.formControl?.parent?.get("capacity_auto")?.setValue(t.toLocaleString())}catch(l){console.log(l),e?.formControl?.parent?.get("capacity_auto")?.setValue("")}else e?.formControl?.parent?.get("capacity_auto")?.setValue("");try{const t=["initial_element","extensions","strap_type","strap_capacity","end_element","length","capacity_auto"];let a="";const o={length:"m",capacity_auto:"kg",strap_capacity:"T",extensions:"R"};for(const r of t){const t=e?.formControl?.parent?.get(r)?.value;if(t){a+=`${t}${o[r]?o[r]:""}, `}}a=a.slice(0,-2),e?.formControl?.parent?.get("description")?.setValue(a)}catch(l){e?.formControl?.parent?.get("description")?.setValue("")}}else{if(s&&r&&a&&i)try{const t=n.ItemCapacityDataEslinga[i][r][4===a?3:a];e?.formControl?.parent?.get("capacity_auto")?.setValue(t.toLocaleString())}catch(l){console.log(l),e?.formControl?.parent?.get("capacity_auto")?.setValue("")}else e?.formControl?.parent?.get("capacity_auto")?.setValue("");try{const t=["initial_element","extensions","degree_iron","nominal_diameter","end_element","length","capacity_auto"];let a="";const o={length:"m",capacity_auto:"kg",nominal_diameter:"mm",extensions:"R"},r={degree_iron:"G"};for(const i of t){const t=e?.formControl?.parent?.get(i)?.value;if(t){const e=o[i]?o[i]:"";a+=`${r[i]?r[i]:""}${t}${e}, `}}a=a.slice(0,-2),e?.formControl?.parent?.get("description")?.setValue(a)}catch(l){e?.formControl?.parent?.get("description")?.setValue("")}}};return t(e.formControl.value),e.formControl.valueChanges.pipe((0,i.tap)((e=>(console.log("tap",e),t()))))}}:{};return{key:`data.${e}`,type:`${t.type}`,templateOptions:{...o.iaDefaultField.templateOptions,label:t.label,...t.templateOptions?.readonly?{readonly:!0}:null,...t.options?{options:t.options}:null},hideExpression:t=>{const a=t?.data?.type;if(!a)return!0;const o=r.ItemTypes.find((e=>e.itemType===a));return!o||o?.fields.indexOf(e)<0},hooks:a}}))],l=[{key:"data.type",type:"select-modal",templateOptions:{...o.iaDefaultField.templateOptions,label:"Tipo de Item",required:!0,options:r.ItemTypes,valueProp:"itemType",labelProp:"name"}},{key:"traceability",type:"input",templateOptions:{...o.iaDefaultField.templateOptions,label:"Placa de rastreabilidade Seyconel",placeholder:"Preencha a rastreabilidade",required:!0}},{key:"approved",type:"toggle",defaultValue:!1,templateOptions:{...o.iaDefaultField.templateOptions,label:"Aprovado?",required:!1}},...Object.keys(r.ItemDataFields).map((e=>{const t=r.ItemDataFields[e],a=["nominal_diameter","extensions","degree_iron","strap_capacity","initial_element","strap_type","strap_capacity","end_element","length","capacity_select","diameter","capacity"].indexOf(e)>-1?{onInit:e=>{if(!e||!e?.formControl)return;const t=t=>{const a=e?.formControl?.parent?.get("extensions")?.value,o=e?.formControl?.parent?.get("strap_capacity")?.value,r=e?.formControl?.parent?.get("nominal_diameter")?.value,i=e?.formControl?.parent?.get("degree_iron")?.value,s=e?.formControl?.parent?.get("type")?.value;if(console.log("calcTable",{type:s,nominal_diameter:r,extensions:a,degree_iron:i,strap_capacity:o}),6!==s)if(5!==s){if(7===s)try{const t=["strap_type","length","capacity_select"];let a="";const o={length:"m",capacity_select:"T"};for(const r of t){const t=e?.formControl?.parent?.get(r)?.value;if(t){a+=`${t}${o[r]?o[r]:""}, `}}a=a.slice(0,-2),e?.formControl?.parent?.get("description")?.setValue(a)}catch(l){e?.formControl?.parent?.get("description")?.setValue("")}if(9===s)try{const t=["diameter","length","capacity"];let a="Cabo de a\xe7o, ";const o={diameter:"mm",length:"m",capacity:"T"};for(const r of t){const t=e?.formControl?.parent?.get(r)?.value;if(t){a+=`${t}${o[r]?o[r]:""}, `}}a=a.slice(0,-2),e?.formControl?.parent?.get("description")?.setValue(a)}catch(l){e?.formControl?.parent?.get("description")?.setValue("")}if(1===s)try{const t=["initial_element","extensions","","diameter","end_element","length","capacity"];let a="";const o={diameter:"mm",length:"m",capacity:"T",extensions:"R"};for(const r of t)if(""!==r){const t=e?.formControl?.parent?.get(r)?.value;if(t){a+=`${t}${o[r]?o[r]:""}, `}}else a+="Cabo de a\xe7o, ";a=a.slice(0,-2),e?.formControl?.parent?.get("description")?.setValue(a)}catch(l){e?.formControl?.parent?.get("description")?.setValue("")}}else{if(o&&a)try{const t=n.ItemCapacityDataLinga[o][4===a?3:a];e?.formControl?.parent?.get("capacity_auto")?.setValue(t.toLocaleString())}catch(l){console.log(l),e?.formControl?.parent?.get("capacity_auto")?.setValue("")}else e?.formControl?.parent?.get("capacity_auto")?.setValue("");try{const t=["initial_element","extensions","strap_type","strap_capacity","end_element","length","capacity_auto"];let a="";const o={length:"m",capacity_auto:"kg",strap_capacity:"T",extensions:"R"};for(const r of t){const t=e?.formControl?.parent?.get(r)?.value;if(t){a+=`${t}${o[r]?o[r]:""}, `}}a=a.slice(0,-2),e?.formControl?.parent?.get("description")?.setValue(a)}catch(l){e?.formControl?.parent?.get("description")?.setValue("")}}else{if(s&&r&&a&&i)try{const t=n.ItemCapacityDataEslinga[i][r][4===a?3:a];e?.formControl?.parent?.get("capacity_auto")?.setValue(t.toLocaleString())}catch(l){console.log(l),e?.formControl?.parent?.get("capacity_auto")?.setValue("")}else e?.formControl?.parent?.get("capacity_auto")?.setValue("");try{const t=["initial_element","extensions","degree_iron","nominal_diameter","end_element","length","capacity_auto"];let a="";const o={length:"m",capacity_auto:"kg",nominal_diameter:"mm",extensions:"R"},r={degree_iron:"G"};for(const i of t){const t=e?.formControl?.parent?.get(i)?.value;if(t){const e=o[i]?o[i]:"";a+=`${r[i]?r[i]:""}${t}${e}, `}}a=a.slice(0,-2),e?.formControl?.parent?.get("description")?.setValue(a)}catch(l){e?.formControl?.parent?.get("description")?.setValue("")}}};return t(e.formControl.value),e.formControl.valueChanges.pipe((0,i.tap)((e=>(console.log("tap",e),t()))))}}:{};return{key:`data.${e}`,type:`${t.type}`,templateOptions:{...o.iaDefaultField.templateOptions,label:t.label,...t.templateOptions?.readonly?{readonly:!0}:null,...t.options?{options:t.options}:null},hideExpression:t=>{const a=t?.data?.type;if(!a)return!0;const o=r.ItemTypes.find((e=>e.itemType===a));return!o||o?.fields.indexOf(e)<0},hooks:a}}))],d=[{key:"traceability",type:"input",templateOptions:{...o.iaDefaultField.templateOptions,label:"Placa de rastreabilidade Seyconel",placeholder:"Preencha a rastreabilidade",required:!0}},{key:"sectorId",type:"select-modal",templateOptions:{...o.iaDefaultField.templateOptions,label:"Setor",required:!0,dynamicOptions:{entityId:"sectors",group:"survey.name",label:"name",value:"id"}}},{key:"approved",type:"toggle",templateOptions:{...o.iaDefaultField.templateOptions,label:"Aprovado?"}}],c=[{name:"Placa de Rastreabilidade",prop:"traceability"},{name:"Tipo",prop:"data.type",pipe:{transform:e=>r.ItemTypes.find((t=>t.itemType===e))?.name}},{name:"Aprovado",prop:"approved",pipe:{transform:e=>e?"Sim":"N\xe3o"}},{name:"Setor",prop:"sector.name"},{name:"Vistoria",prop:"sector.survey.name",sortable:!1},{name:"Cliente",prop:"sector.survey.customer.name",sortable:!1}],p=[{name:"Placa de Rastreabilidade",prop:"traceability"},{name:"Aprovado",prop:"approved",render:e=>""+(e?"Sim":"N\xe3o")},{name:"Tipo",prop:"data.type",render:e=>`${r.ItemTypes.find((t=>t.itemType===e))?.name}`},{name:"Setor",prop:"sector.name",url:e=>`/admin/sectors/detail/${e.sector.id}`},{name:"Vistoria",prop:"sector.survey.name",url:e=>`/admin/surveys/detail/${e.sector.survey.id}`},{name:"Cliente",prop:"sector.survey.customer.name",url:e=>`/admin/customers/detail/${e.sector.survey.customer.id}`},{name:"Fotos",prop:"photosCount",url:e=>`/admin/photos/list?itemId=${e.id}`}];t.itemEntity={items:{id:"items",label:"Itens",labelSingular:"Item",keyField:"id",displayField:"name",icon:"checkbox",actions:["list","detail","add","edit","remove","export","filter"],form:{fields:s},appForm:{fields:l},filters:{fields:d},list:{columns:c,queryFilters:["sectorId"]},detail:{fields:p}}}},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.photoEntity=void 0;const o=a(94),r=[{key:"file",type:"file",templateOptions:{...o.iaDefaultField.templateOptions,label:"Arquivo",filePath:()=>"",placeholder:"Preencha o nome completo",required:!0}},{key:"photoUrl",type:"hidden",templateOptions:{...o.iaDefaultField.templateOptions,type:"hidden"}},{key:"item.id",type:"select-modal",templateOptions:{...o.iaDefaultField.templateOptions,label:"Item",required:!0,dynamicOptions:{entityId:"items",label:"name",value:"id"}}}],i=[{key:"itemId",type:"select-modal",templateOptions:{...o.iaDefaultField.templateOptions,label:"Item",required:!0,dynamicOptions:{entityId:"items",label:"name",value:"id"}}}];t.photoEntity={photos:{id:"photos",label:"Fotos",labelSingular:"Foto",keyField:"id",displayField:"photoUrl",icon:"camera",actions:["detail","add","edit","remove","export","search","filter"],search:e=>({$or:[{photoUrl:{$cont:e}}]}),filters:{fields:i},form:{fields:r},appForm:{fields:[]},list:{columns:[{name:"Foto",prop:"photoUrl",maxWidth:100,cellClass:"cell-no-padding",pipe:{transform:e=>`<img height="46" src="${e}" />`}},{name:"URL",prop:"photoUrl"},{name:"Item",prop:"item.name"}],queryFilters:["itemId"]},detail:{fields:[{name:"File",prop:"file"},{name:"Url",prop:"photoUrl"},{name:"Criado em",prop:"createdAt",render:e=>e},{name:"Atualizado em",prop:"modifiedAt",render:e=>e}]}}}},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.reportEntity=void 0;const o=a(94),r=a(98),i=(0,a(88).format)(new Date,"MMMM 'de' yyyy",{locale:r.ptBR}),n=[{key:"name",type:"input",defaultValue:i[0].toUpperCase()+i.substr(1).toLowerCase(),templateOptions:{...o.iaDefaultField.templateOptions,label:"Nome",placeholder:"Preencha o nome completo",required:!0}}],s=[{key:"name",type:"input",templateOptions:{...o.iaDefaultField.templateOptions,label:"Nome",placeholder:"Preencha o nome completo",required:!0}}],l=[{key:"name",type:"input",templateOptions:{...o.iaDefaultField.templateOptions,label:"Nome",placeholder:"Preencha o nome completo"}}],d=[{name:"Nome",prop:"name"},{name:"RI",prop:"ri"},{name:"Criado em",prop:"createdAt",render:e=>e},{name:"Atualizado em",prop:"modifiedAt",render:e=>e},{name:"Dados",prop:"data",render:e=>`${JSON.stringify(e)}`}];t.reportEntity={reports:{id:"reports",label:"Relat\xf3rios",labelSingular:"Relat\xf3rio",keyField:"id",displayField:"name",icon:"print",actions:["list","detail","add","edit","remove","export","search","filter","print"],search:e=>({$or:[{name:{$cont:e}}]}),filters:{fields:l},form:{fields:s},appForm:{fields:n},list:{columns:[{name:"Nome",prop:"name"},{name:"RI",prop:"ri"},{name:"Atualizado em",prop:"modifiedAt",pipe:{transform:e=>e},maxWidth:200,minWidth:200}]},detail:{fields:d}}}},e=>{e.exports=require("date-fns/locale")},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sectorEntity=void 0;const o=a(94),r=[{key:"name",type:"input",templateOptions:{...o.iaDefaultField.templateOptions,label:"Nome",placeholder:"Preencha o nome completo",required:!0}},{key:"survey.id",type:"select-modal",templateOptions:{...o.iaDefaultField.templateOptions,label:"Vistoria",required:!0,dynamicOptions:{entityId:"surveys",label:"name",value:"id"}}}],i=[{key:"name",type:"input",templateOptions:{...o.iaDefaultField.templateOptions,label:"Nome",placeholder:"Preencha o nome completo",required:!0}}],n=[{key:"name",type:"input",templateOptions:{...o.iaDefaultField.templateOptions,label:"Nome",placeholder:"Preencha o nome completo"}},{key:"surveyId",type:"select-modal",templateOptions:{...o.iaDefaultField.templateOptions,label:"Vistoria",required:!0,dynamicOptions:{entityId:"surveys",label:"name",value:"id"}}}];t.sectorEntity={sectors:{id:"sectors",label:"Setores",labelSingular:"Setor",keyField:"id",displayField:"name",icon:"layers",actions:["list","detail","add","edit","remove","export","search","filter"],search:e=>({$or:[{name:{$cont:e}},{"customer.name":{$cont:e}}]}),filters:{fields:n},form:{fields:r},appForm:{fields:i},list:{columns:[{name:"Nome",prop:"name"},{name:"Vistoria",prop:"survey.name"},{name:"Itens",prop:"itemsCount",maxWidth:80}],queryFilters:["surveyId"]},detail:{fields:[{name:"Nome",prop:"name"},{name:"Itens",prop:"itemsCount",url:e=>`/admin/items/list?sectorId=${e.id}`},{name:"Vistoria",prop:"survey.name",url:e=>`/admin/surveys/detail/${e.survey.id}`},{name:"Cliente",prop:"survey.customer.name",url:e=>`/admin/customers/detail/${e.survey.customer.id}`},{name:"Criado em",prop:"createdAt",render:e=>e},{name:"Atualizado em",prop:"modifiedAt",render:e=>e}]}}}},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.surveyEntity=void 0;const o=a(94),r=a(98),i=a(88),n=(0,i.format)(new Date,"MMMM 'de' yyyy",{locale:r.ptBR}),s=n[0].toUpperCase()+n.substr(1).toLowerCase(),l=(0,i.format)(new Date,"yyyy",{locale:r.ptBR}),d=(0,i.format)(new Date,"M",{locale:r.ptBR}),c=[{key:"name",type:"input",defaultValue:s,templateOptions:{...o.iaDefaultField.templateOptions,label:"Nome",placeholder:"Preencha o nome completo",required:!0}},{key:"city",type:"input",templateOptions:{...o.iaDefaultField.templateOptions,label:"Cidade",placeholder:"Preencha a cidade",required:!0}},{key:"state",type:"input",templateOptions:{...o.iaDefaultField.templateOptions,label:"Estado",placeholder:"Preencha o estado",required:!0}},{key:"month",type:"input",defaultValue:d,templateOptions:{...o.iaDefaultField.templateOptions,label:"M\xeas",placeholder:"Preencha o m\xeas",required:!0}},{key:"year",type:"input",defaultValue:l,templateOptions:{...o.iaDefaultField.templateOptions,label:"Ano",placeholder:"Preencha o ano",required:!0}},{key:"completed",type:"toggle",templateOptions:{...o.iaDefaultField.templateOptions,label:"Conclu\xeddo"}}],p=[{key:"name",type:"input",templateOptions:{...o.iaDefaultField.templateOptions,label:"Nome",placeholder:"Preencha o nome completo",required:!0}},{key:"city",type:"input",templateOptions:{...o.iaDefaultField.templateOptions,label:"Cidade",placeholder:"Preencha a cidade",required:!0}},{key:"state",type:"input",templateOptions:{...o.iaDefaultField.templateOptions,label:"Estado",placeholder:"Preencha o estado",required:!0}},{key:"month",type:"input",defaultValue:d,templateOptions:{...o.iaDefaultField.templateOptions,label:"M\xeas",placeholder:"Preencha o m\xeas",required:!0}},{key:"year",type:"input",defaultValue:l,templateOptions:{...o.iaDefaultField.templateOptions,label:"Ano",placeholder:"Preencha o ano",required:!0}},{key:"customer.id",type:"select-modal",templateOptions:{...o.iaDefaultField.templateOptions,label:"Cliente",required:!0,dynamicOptions:{entityId:"customers",label:"name",value:"id"}}},{key:"completed",type:"toggle",templateOptions:{...o.iaDefaultField.templateOptions,label:"Conclu\xeddo"}}],m=[{key:"name",type:"input",templateOptions:{...o.iaDefaultField.templateOptions,label:"Nome",placeholder:"Preencha o nome completo"}},{key:"customerId",type:"select-modal",templateOptions:{...o.iaDefaultField.templateOptions,label:"Cliente",required:!0,dynamicOptions:{entityId:"customers",label:"name",value:"id"}}},{key:"completed",type:"toggle",templateOptions:{...o.iaDefaultField.templateOptions,label:"Conclu\xeddo"}}];t.surveyEntity={surveys:{id:"surveys",label:"Vistorias",labelSingular:"Vistoria",keyField:"id",displayField:"name",icon:"list",actions:["list","detail","add","edit","remove","export","search","filter","report"],search:e=>({$or:[{name:{$cont:e}},{"customer.name":{$cont:e}}]}),filters:{fields:m},form:{fields:p},appForm:{fields:c},list:{columns:[{name:"Nome",prop:"name"},{name:"Cliente",prop:"customer.name"},{name:"Conclu\xeddo",prop:"completed",maxWidth:80,pipe:{transform:e=>e?"Sim":"N\xe3o"}},{name:"Setores",prop:"sectorsCount",maxWidth:80},{name:"Atualizado em",prop:"modifiedAt",pipe:{transform:e=>e},maxWidth:200,minWidth:200}],queryFilters:["customerId"]},detail:{fields:[{name:"Nome",prop:"name"},{name:"Cidade",prop:"city"},{name:"Estado",prop:"state"},{name:"M\xeas",prop:"month"},{name:"Ano",prop:"year"},{name:"Cliente",prop:"customer.name",url:e=>`/admin/customers/detail/${e.customerId}`},{name:"Conclu\xeddo",prop:"completed",render:e=>e?"Sim":"N\xe3o"},{name:"Setores",prop:"sectorsCount",url:e=>`/admin/sectors/list?surveyId=${e.id}`},{name:"Criado em",prop:"createdAt",render:e=>e},{name:"Atualizado em",prop:"modifiedAt",render:e=>e}]}}}},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.userEntity=void 0;const o=a(94),r=[{key:"name",type:"input",templateOptions:{...o.iaDefaultField.templateOptions,label:"Nome",placeholder:"Preencha o nome completo.",required:!0}},{key:"email",type:"input",templateOptions:{...o.iaDefaultField.templateOptions,type:"email",label:"E-mail",placeholder:"Preencha um e-mail v\xe1lido.",required:!0}},{key:"password",type:"input",templateOptions:{...o.iaDefaultField.templateOptions,label:"Senha",type:"password",placeholder:"Preencha a senha.",required:!0}},{key:"isActive",type:"checkbox",templateOptions:{...o.iaDefaultField.templateOptions,label:"Est\xe1 ativo?",required:!0}}];t.userEntity={users:{id:"users",label:"Usu\xe1rios",labelSingular:"Usu\xe1rio",keyField:"id",displayField:"name",icon:"people",actions:["list","detail","add","edit","remove","export"],form:{fields:r},list:{columns:[{name:"Nome",prop:"name"},{name:"E-mail",prop:"email"}]},detail:{fields:[{name:"Nome",prop:"name"},{name:"E-mail",prop:"email"}]}}}},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.logEntity=void 0;const o=[{key:"name",type:"input",templateOptions:{...a(94).iaDefaultField.templateOptions,label:"Nome",placeholder:"Preencha o nome completo",required:!0}}];t.logEntity={logs:{id:"logs",label:"Logs",labelSingular:"Log",keyField:"id",displayField:"name",icon:"receipt",actions:["list","detail","export","search"],form:{fields:o},list:{columns:[{name:"Nome",prop:"name"}]},detail:{fields:[{name:"Nome",prop:"name"}]}}}},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.staticPath=void 0;const o=a(79);t.staticPath=(0,o.join)(__dirname,"..","..","..","..","shared","files","seyconel")},e=>{e.exports=require("chartist-svg")},e=>{e.exports=require("fs")},e=>{e.exports=require("ghostscript4js")},e=>{e.exports=require("google-charts-node")},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.reportProviders=void 0;const o=a(13),r=a(26),i=a(113),n=a(66),s=a(12);t.reportProviders=[{provide:i.REPORT_REPOSITORY,useFactory:e=>e.getRepository(o.ReportEntity),inject:[r.DATABASE_CONNECTION]},{provide:n.SURVEY_REPOSITORY,useFactory:e=>e.getRepository(s.SurveyEntity),inject:[r.DATABASE_CONNECTION]}]},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.REPORT_REPOSITORY=void 0,t.REPORT_REPOSITORY="REPORT_REPOSITORY"},e=>{e.exports=require("body-parser")},e=>{e.exports=require("helmet")}],t={};function a(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,a),i.exports}var o={};(()=>{var e=o;Object.defineProperty(e,"__esModule",{value:!0});const t=a(1),r=a(2),i=a(3),n=a(114),s=a(115),l=a(107);!async function(){const e=await r.NestFactory.create(i.AppModule);e.setGlobalPrefix("api"),e.enableCors(),e.use(s()),e.use(n.json({limit:"50mb"})),e.use(n.urlencoded({limit:"50mb",extended:!0})),e.enableCors(),console.log({staticPath:l.staticPath}),e.useStaticAssets(l.staticPath,{prefix:"/files"});const a=process.env.PORT||3333;await e.listen(a,(()=>{t.Logger.log("Listening at http://localhost:"+a+"/api")}))}()})();var r=exports;for(var i in o)r[i]=o[i];o.__esModule&&Object.defineProperty(r,"__esModule",{value:!0})})();
//# sourceMappingURL=main.js.map